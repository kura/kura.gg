<!DOCTYPE html><!--

                                      |
                                     /|
                                   ,' |
                                  .   |
                                    | |
                                 ' '| |
                                / / | |
       _,.-\"\"--._              / /  | |
     ,'          `.           j '   ' '
   ,'              `.         ||   / ,                         ___..--,
  /                  \\        ' `.'`.-.,-\".  .       _..---\"\"'' __, ,'
 /                    \\        \\` .\"`      `\"'\\   ,'\"_..--''\"\"\"'.'.'
.                      .      .'-'             \\,' ,'         ,','
|                      |      ,`               ' .`         .' /
|                      |     /          ,\"`.  ' `-. _____.-' .'
'                      |..---.|,\".      | | .  .-'\"\"   __.,-'
 .                   ,'       ||,|      |.' |    |\"\"`'\"
  `-._   `._.._____  |        || |      `._,'    |
      `.   .       `\".     ,'\"| \"  `'           ,+.
        \\  '         |    '   |   .....        .'  `.
         .'          '     7  \".              ,'     \\
                   ,'      |    `..        _,'      F
                  .        |,      `'----''         |
                  |      ,\"j  /                   | '
                  `     |  | .                 | `,'
                   .    |  `.|                 |/
                    `-..'   ,'                .'
                            | \\             ,''
                            |  `,'.      _,' /
                            |    | ^.  .'   /
                             `-'.' j` V    /
                                   |      /
                                   |     /
                                   |   ,'
                                    `\"\"

//--><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0, minimum-scale=1.0"><link rel=alternate href=https://kura.gg hreflang=en><link rel=dns-prefetch href=https://kura.gg><link rel=dns-prefetch href=//disqus.com><link rel=dns-prefetch href=//a.disquscdn.com><link rel=dns-prefetch href=//syslogtv.disqus.com><link rel=dns-prefetch href=//glitter-services.disqus.com><link href=https://kura.gg/feeds/rss.xml type=application/rss+xml rel=alternate title=kura.gg><link href=https://kura.gg/feeds/atom.xml type=application/atom+xml rel=alternate title=kura.gg><meta property=og:site_name content=kura.gg><meta property=og:type content=article><meta property=og:title content="Show IP in Apache logs from nginx reverse proxy"><meta content=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/ property=og:url><meta property=og:description content="This is a very quick blog to show you how to show a users IP address in your Apache access logs when the site in question is being reverse proxied to Apache through nginx. You need the rpaf module for Apache, on Debian and Ubuntu this is simple to install sudo apt-get install libapache2-mod-rpaf sudo a2enmod rpaf sudo /etc/init.d/apache2 restart This set of commands will do the following; Update apt package list Install libapache2-mod-rpaf Enable mod-rpaf Gracefully restart Apache (doesn’t kill connections) Once installed you simple need to be sure to pass the correct headers through, so open up one of your nginx site configuration files and add the following within the server definition. proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; So you should have something that looks like this, but without the “… snip …” server { # ...snip... location / { # ...snip... proxy_set_header X-Forwarded-For $proxy_add …"><meta property=og:image content=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/index.png><meta property=og:image:width content=1920><meta property=og:image:height content=1080><meta property=twitter:site content=@kuramanga><meta property=twitter:title content="Show IP in Apache logs from nginx reverse proxy"><meta content=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/ property=twitter:url><meta property=twitter:description content="This is a very quick blog to show you how to show a users IP address in your Apache access logs when the site in question is being reverse proxied to Apache through nginx. You need the rpaf module for Apache, on Debian and Ubuntu this is simple to install sudo apt-get install libapache2-mod-rpaf sudo a2enmod rpaf sudo /etc/init.d/apache2 restart This set of commands will do the following; Update apt package list Install libapache2-mod-rpaf Enable mod-rpaf Gracefully restart Apache (doesn’t kill connections) Once installed you simple need to be sure to pass the correct headers through, so open up one of your nginx site configuration files and add the following within the server definition. proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; So you should have something that looks like this, but without the “… snip …” server { # ...snip... location / { # ...snip... proxy_set_header X-Forwarded-For $proxy_add …"><meta property=twitter:image content=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/index.png><meta property=twitter:card content=summary_large_image><meta property=twitter:image:width content=1920><meta property=twitter:image:height content=1080><link rel=icon href=/favicon.png type=image/png sizes="16x16 32x32 48x48 64x64 128x128 256x256"><link rel=icon href=/favicon.ico type=image/vnd.microsoft.icon sizes="16x16 32x32 48x48 64x64 128x128 256x256"><title>Show IP in Apache logs from nginx reverse proxy</title></head> <body> <div class="eevee-layout mdl-layout mdl-js-layout mdl-color--grey-50"> <header class="eevee-header mdl-color--grey-50 mdl-color-text--grey-800" itemscope itemtype=http://schema.org/WPHeader> <div class=mdl-layout__header-row> <div aria-expanded=false role=button tabindex=0 class="mdl-layout__drawer-button mdl-color-text--accent eevee-mobile-button mdl-layout--small-screen-only"> <i class=material-icons>&#xE5D2;</i> </div> <span class="eevee-logo mdl-color-text--accent mdl-layout-title"> <h2 id=top> <a href=https://kura.gg rel=bookmark title=kura.gg> kura.gg </a> </h2> </span> <div class=mdl-layout-spacer role=presentation></div> <nav class="eevee-nav mdl-navigation mdl-layout--large-screen-only" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Header navigation"> <a class="mdl-color-text--accent mdl-navigation__link" href=/eevee/ itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/software/ itemprop=url rel=bookmark title=Software> <i class=material-icons aria-hidden=true>&#xE86F;</i> Software </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </nav> </div> </header> <div class="eevee-mobile-header mdl-layout__drawer mdl-color--white" aria-hidden=true> <span class=mdl-layout-title> <h2 class="eevee-mobile-logo mdl-color-text--accent"> kura.gg </h2> </span> <div class="mdl-navigation mdl-color--white"> <nav class="eevee-nav mdl-navigation" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Header navigation"> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg itemprop=url rel=bookmark> <i class=material-icons aria-hidden=true> &#xE88A; </i> Home </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/eevee/ itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/software/ itemprop=url rel=bookmark title=Software> <i class=material-icons aria-hidden=true>&#xE86F;</i> Software </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </nav> </div> </div> <div class="eevee-ribbon mdl-color--primary-dark" role=presentation> </div> <main class="eevee-main mdl-layout__content"> <div class="eevee-container mdl-grid"> <div role=presentation class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"> </div> <div class="eevee-content mdl-color--white mdl-shadow--2dp mdl-color-text--grey-800 mdl-cell mdl-cell--8-col" aria-label="Main content"> <article itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,log,nginx,proxy> <meta itemprop=keywords content=tutorials> <div class=eevee-share> <ul class="social-share mdl-navigation"> <li class="social-share__link social-share__link--twitter"> <a href="https://twitter.com/intent/tweet?text=Show%20IP%20in%20Apache%20logs%20from%20nginx%20reverse%20proxy&url=https%3A//kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/&related=kuramanga" title="Share 'Show IP in Apache logs from nginx reverse proxy' on Twitter" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235'); return false;"> <i class=fa aria-hidden=true>&#xF099;</i> </a> </li> <li class="social-share__link social-share__link--facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/" title="Share 'Show IP in Apache logs from nginx reverse proxy' on Facebook" onclick="window.open(this.href, 'facebook-share', 'width=580,height=296'); return false;"> <i class=fa aria-hidden=true>&#xF09A;</i> </a> </li> <li class="social-share__link social-share__link--email"> <a href="mailto:?subject=Show%20IP%20in%20Apache%20logs%20from%20nginx%20reverse%20proxy&body=I%20thought%20you%20might%20like%20'Show%20IP%20in%20Apache%20logs%20from%20nginx%20reverse%20proxy'%20--%20https%3A//kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/" title="Share 'Show IP in Apache logs from nginx reverse proxy' via email"> <i class=material-icons aria-hidden=true> &#xE0E1; </i> </a> </li> <li class="social-share__link social-share__link--comment"> <a href=#article-comments title="Discuss 'Show IP in Apache logs from nginx reverse proxy'"> <i class=material-icons aria-hidden=true> &#xE0B9; </i> </a> </li> </ul> </div> <div class=eevee-article> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-03-20T19:24:00+00:00 itemprop=datePublished> 20 Mar 2010 </time>&nbsp;-- < 1 min read </div> <h1 itemprop=name> <a href=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/ rel=bookmark title="Permalink to 'Show IP in Apache logs from nginx reverse proxy'" itemprop=url> Show <span class=caps>IP</span> in Apache logs from nginx reverse&nbsp;proxy </a> </h1> <section itemprop=articleBody class=article-content> <p>This is a very quick blog to show you how to show a users <span class=caps>IP</span> address in your Apache access logs when the site in question is being reverse proxied to Apache through nginx.</p> <p>You need the rpaf module for Apache, on Debian and Ubuntu this is simple to install</p> <div class=highlight><pre><span></span>sudo apt-get install libapache2-mod-rpaf
sudo a2enmod rpaf
sudo /etc/init.d/apache2 restart
</pre></div> <p>This set of commands will do the following;</p> <ol class="arabic simple"> <li>Update apt package list</li> <li>Install libapache2-mod-rpaf</li> <li>Enable mod-rpaf</li> <li>Gracefully restart Apache (doesn’t kill connections)</li> </ol> <p>Once installed you simple need to be sure to pass the correct headers through, so open up one of your nginx site configuration files and add the following within the server definition.</p> <div class=highlight><pre><span></span><span class=k>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</pre></div> <p>So you should have something that looks like this, but without the “… snip …”</p> <div class=highlight><pre><span></span><span class=k>server</span> <span class=p>{</span>
    <span class=c1># ...snip...</span>
    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
        <span class=c1># ...snip...</span>
        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
        <span class=c1># ...snip...</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> </section> </div> <div class=eevee-related> <section> <h2>Related articles</h2> <ul> <li> <a href=https://kura.gg/2010/04/18/new-syslog-tv-nginx-wordpress-site-configuration/ rel=bookmark title="Permalink to 'New syslog.tv nginx wordpress site configuration explained'" itemprop=url> New syslog.tv nginx wordpress site configuration&nbsp;explained </a> </li> <li> <a href=https://kura.gg/2011/08/10/nginx-log-real-ip-from-pound/ rel=bookmark title="Permalink to 'nginx log real IP from Pound'" itemprop=url> nginx log real <span class=caps>IP</span> from&nbsp;Pound </a> </li> <li> <a href=https://kura.gg/2010/09/26/nginx-varnish-apache2/ rel=bookmark title="Permalink to 'WordPress + nginx + Varnish + Apache 2'" itemprop=url> WordPress + nginx + Varnish + Apache&nbsp;2 </a> </li> <li> <a href=https://kura.gg/2010/02/14/more-nginx-proxy_cache-optimizations-and-nginx-load-balancing/ rel=bookmark title="Permalink to 'More nginx proxy_cache optimizations and nginx load balancing'" itemprop=url> More nginx proxy_cache optimizations and nginx load&nbsp;balancing </a> </li> <li> <a href=https://kura.gg/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/ rel=bookmark title="Permalink to 'nginx, proxy_cache and reverse proxying explained & benchmarked'" itemprop=url> nginx, proxy_cache and reverse proxying explained <span class=amp>&amp;</span>&nbsp;benchmarked </a> </li> </ul> </section> </div> <div class=eevee-ac> <header class=eevee-ac__header> <div class=eevee-ac-author__text> <h2>Kura</h2> <p>Anarchist. Pessimist. Bipolar. Hacker. Hyperpolyglot. Musician. Ex-(semi-)pro gamer. They/Them.</p> <p> <a href=https://kura.gg/authors/kura/ itemprop=url title="Read more articles by Kura"> Read more articles by Kura </a> </p> <nav> <ul class=eevee-ac-author__social> <li class=eevee-ac-author-social__link> <a class="mdl-color-text--accent mdl-navigation__link" href=https://github.com/kura itemprop=url rel=bookmark title="kura on GitHub"> <i class=fa aria-hidden=true>&#xF09B;</i> </a> </li> </ul> </nav> </div> <img src=/images/avatar.png class=eevee-ac-author__avatar alt=Kura> </header> </div> <div class=eevee-comment id=article-comments> <section itemscope itemtype=http://schema.org/UserComments> <h2>Join the discussion</h2> <div id=disqus_thread></div> <noscript> Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a> </noscript> </section> </div> </article> <a href=https://github.com/kura/kura.gg/blob/main/content/show-ip-in-apache-logs-from-nginx-reverse-proxy.rst id=view-source title="View 'Show IP in Apache logs from nginx reverse proxy' on GitHub" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-color--accent mdl-color-text--white"> <i class=material-icons>&#xE86F;</i> View Source </a> </div> </div> </main> <div class="eevee-pagination__container eevee-container mdl-grid"> <div role=presentation class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"> </div> <div class="mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"> <nav class="eevee-pagination mdl-cell mdl-cell--12-col" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label=Pagination> <a href=https://kura.gg/2010/03/21/configuring-nagios-to-monitor-remote-load-disk-using-nrpe/ class=eevee-nav__button itemprop=url rel=bookmark title=Newer> <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation> <i class=material-icons>&#xE5C4;</i> </button> Newer </a> <div class=eevee-spacer></div> <a href=https://kura.gg/2010/03/18/nginx-increase-increase-server_names_hash_bucket_size/ class=eevee-nav__button itemprop=url rel=bookmark title=Older> Older <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation> <i class=material-icons>&#xE5C8;</i> </button> </a> </nav> </div> </div> <footer class=mdl-mega-footer itemscope itemtype=http://schema.org/SiteNavigationElement> <div class=mdl-mega-footer--top-section> <div class=mdl-mega-footer--drop-down-section> <ul class=mdl-mega-footer--link-list> <li> <a href=#top itemprop=url title="Back to the top of the page"> Back to the top of the page </a> </li> </ul> </div> </div> <div class=mdl-mega-footer--middle-section itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Footer navigation"> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Menu</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=/eevee/ itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> </li> <li> <a href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> </li> <li> <a href=/software/ itemprop=url rel=bookmark title=Software> <i class=material-icons aria-hidden=true>&#xE86F;</i> Software </a> </li> <li> <a href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> </li> <li> <a href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </li> </ul> </div> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Social</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=https://github.com/kura itemprop=url rel=bookmark title=GitHub> <i class=fa aria-hidden=true>&#xF09B;</i> Github </a> </li> </ul> </div> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Links</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=https://kura.gg/blackhole itemprop=url rel=bookmark title=Blackhole> <i class=material-icons aria-hidden=true>&#xE86F;</i> Blackhole </a> </li> <li> <a href=https://kura.gg/yarg itemprop=url rel=bookmark title=Yarg> <i class=material-icons aria-hidden=true>&#xE86F;</i> Yarg </a> </li> <li> <a href=https://kura.gg/eevee itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> </li> <li> <a href=https://kura.gg/hauntr itemprop=url rel=bookmark title=Hauntr> <i class=material-icons aria-hidden=true>&#xE871;</i> Hauntr </a> </li> <li> <a href=https://kura.gg/ghastly itemprop=url rel=bookmark title=Ghastly> <i class=material-icons aria-hidden=true>&#xE871;</i> Ghastly </a> </li> </ul> </div> </div> <div class=mdl-mega-footer--bottom-section> <div class=mdl-logo> <a href=https://kura.gg rel=bookmark itemprop=url title=kura.gg> kura.gg </a> </div> <ul class="eevee-footer mdl-mega-footer--link-list"> <li>Powered by love &amp; rainbow sparkles.</li> <li>Source code and content released under the <a href=/license/ title="MIT license">MIT license</a>.</li> </ul> </div> </footer> </div> <link rel=stylesheet href=https://kura.gg/theme/css/eevee.min.css?e96887dc> <script async src=https://kura.gg/theme/js/eevee.min.js?9eda6833></script> </body> </html>