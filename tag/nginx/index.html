<!DOCTYPE html><!--

                                      |
                                     /|
                                   ,' |
                                  .   |
                                    | |
                                 ' '| |
                                / / | |
       _,.-\"\"--._              / /  | |
     ,'          `.           j '   ' '
   ,'              `.         ||   / ,                         ___..--,
  /                  \\        ' `.'`.-.,-\".  .       _..---\"\"'' __, ,'
 /                    \\        \\` .\"`      `\"'\\   ,'\"_..--''\"\"\"'.'.'
.                      .      .'-'             \\,' ,'         ,','
|                      |      ,`               ' .`         .' /
|                      |     /          ,\"`.  ' `-. _____.-' .'
'                      |..---.|,\".      | | .  .-'\"\"   __.,-'
 .                   ,'       ||,|      |.' |    |\"\"`'\"
  `-._   `._.._____  |        || |      `._,'    |
      `.   .       `\".     ,'\"| \"  `'           ,+.
        \\  '         |    '   |   .....        .'  `.
         .'          '     7  \".              ,'     \\
                   ,'      |    `..        _,'      F
                  .        |,      `'----''         |
                  |      ,\"j  /                   | '
                  `     |  | .                 | `,'
                   .    |  `.|                 |/
                    `-..'   ,'                .'
                            | \\             ,''
                            |  `,'.      _,' /
                            |    | ^.  .'   /
                             `-'.' j` V    /
                                   |      /
                                   |     /
                                   |   ,'
                                    `\"\"

//--><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0, minimum-scale=1.0"><link rel=alternate href=https://kura.gg hreflang=en><link rel=dns-prefetch href=https://kura.gg><link rel=stylesheet href=https://kura.gg/theme/css/eevee.min.css?1c9d8344><link rel=preload href=https://kura.gg/theme/css/eevee.min.css?1c9d8344 as=style><script async src=https://kura.gg/theme/js/eevee.min.js?1841d254></script><link rel=preload href=https://kura.gg/theme/js/eevee.min.js?1841d254 as=script><link href=https://kura.gg/feeds/rss.xml type=application/rss+xml rel=alternate title=kura.gg><link href=https://kura.gg/feeds/atom.xml type=application/atom+xml rel=alternate title=kura.gg><meta property=og:site_name content=kura.gg><meta property=og:type content=article><meta property=og:title content=kura.gg><meta property=og:url content=https://kura.gg/tag/nginx/index.html><meta property=og:image content=https://kura.gg/tag/nginx/index.png><meta property=og:image:width content=1920><meta property=og:image:height content=1080><meta property=twitter:title content=kura.gg><meta property=twitter:url content=https://kura.gg/tag/nginx/index.html><meta property=twitter:image content=https://kura.gg/tag/nginx/index.png><meta property=twitter:card content=summary_large_image><meta property=twitter:image:width content=1920><meta property=twitter:image:height content=1080><link rel=icon href=/favicon.png type=image/png sizes="16x16 32x32 48x48 64x64 128x128 256x256"><link rel=icon href=/favicon.ico type=image/vnd.microsoft.icon sizes="16x16 32x32 48x48 64x64 128x128 256x256"><title>Articles with the 'nginx' tag</title></head> <body> <div class="eevee-layout mdl-layout mdl-js-layout mdl-color--grey-50"> <header class="eevee-header mdl-color--grey-50 mdl-color-text--grey-800" itemscope itemtype=http://schema.org/WPHeader> <div class=mdl-layout__header-row> <div aria-expanded=false role=button tabindex=0 class="mdl-layout__drawer-button mdl-color-text--accent eevee-mobile-button mdl-layout--small-screen-only"> <i class=material-icons>&#xE5D2;</i> </div> <span class="eevee-logo mdl-color-text--accent mdl-layout-title"> <h2 id=top> <a href=https://kura.gg rel=bookmark title=kura.gg> kura.gg </a> </h2> </span> <div class=mdl-layout-spacer role=presentation></div> <nav class="eevee-nav mdl-navigation mdl-layout--large-screen-only" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Header navigation"> <a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i class=material-icons aria-hidden=true>&#xE86F;</i> Blackhole </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i class=material-icons aria-hidden=true>&#xE871;</i> Hauntr </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i class=material-icons aria-hidden=true>&#xE871;</i> Ghastly </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/pelican-plugins itemprop=url rel=bookmark title="Pelican Plugins"> <i class=material-icons aria-hidden=true>&#xE86F;</i> Pelican Plugins </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </nav> </div> </header> <div class="eevee-mobile-header mdl-layout__drawer mdl-color--white" aria-hidden=true> <span class=mdl-layout-title> <h2 class="eevee-mobile-logo mdl-color-text--accent"> kura.gg </h2> </span> <div class="mdl-navigation mdl-color--white"> <nav class="eevee-nav mdl-navigation" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Header navigation"> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg itemprop=url rel=bookmark> <i class=material-icons aria-hidden=true> &#xE88A; </i> Home </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i class=material-icons aria-hidden=true>&#xE86F;</i> Blackhole </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i class=material-icons aria-hidden=true>&#xE871;</i> Hauntr </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i class=material-icons aria-hidden=true>&#xE871;</i> Ghastly </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/pelican-plugins itemprop=url rel=bookmark title="Pelican Plugins"> <i class=material-icons aria-hidden=true>&#xE86F;</i> Pelican Plugins </a> <a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> <a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </nav> </div> </div> <div class="eevee-ribbon mdl-color--primary-dark" role=presentation> </div> <main class="eevee-main mdl-layout__content"> <div class="eevee-container mdl-grid"> <div role=presentation class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"> </div> <div class="eevee-content mdl-color--white mdl-shadow--2dp mdl-color-text--grey-800 mdl-cell mdl-cell--8-col" aria-label="Main content"> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=nginx,openresty,lua> <meta itemprop=keywords content=misc> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2020-08-30T17:30:00+01:00 itemprop=datePublished> 30 Aug 2020 </time>&nbsp;-- 10 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2020/08/30/configuring-upstreams-dynamically-with-dns-in-openresty/ rel=bookmark title="Permalink to 'Configuring upstreams dynamically with DNS inÂ OpenResty'" itemprop=url> Configuring upstreams dynamically with <span class=caps>DNS</span> in&nbsp;OpenResty </a> </h2> <section itemprop=articleBody class=summary-content> <p>This article is a continuation of <a href=https://kura.gg/2020/08/09/retrying-dynamically-configured-upstreams-with-openresty/ class="reference external">retrying dynamically configured upstreams</a> that gives an example of how you can configure OpenResty to update your upstream backend servers dynamically with <span class=caps>DNS</span>.</p> <div class=section id=breaking-down-init-worker-by-lua-block> <h2>Breaking down <cite>init_worker_by_lua_block</cite></h2> <p><cite>init_worker_by_lua_block</cite> can be used to make an nginx worker do some fun stuff. In this instance weâre going to use it in conjunction with <cite>ngx.timer.every</cite> and the <cite>resty.dns.resolver</cite>.</p> <p>Here is the full example of my <cite>init_worker_by_lua_block</cite>.</p> <pre class="code lua literal-block">
<span class=n>init_worker_by_lua_block</span> <span class=p>{</span>
    <span class=n>_backend_servers</span> <span class=o>=</span> <span class=p>{}</span>

    <span class=kd>local</span> <span class=kr>function</span> <span class=nf>update_dns</span><span class=p>()</span>
        <span class=c1>-- Set up the resolver</span>
        <span class=kd>local</span> <span class=n>resolver</span> <span class=o>=</span> <span class=nb>require</span> <span class=s2>"resty.dns.resolver"</span>
        <span class=kd>local</span> <span class=n>r</span><span class=p>,</span> <span class=n>err</span> <span class=o>=</span> <span class=n>resolver</span><span class=p>:</span><span class=n>new</span><span class=p>{</span>
            <span class=n>nameservers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"1.1.1.1"</span><span class=p>,</span> <span class=p>{</span><span class=s2>"1.0.0.1"</span><span class=p>,</span> <span class=mi>53</span><span class=p>}</span> <span class=p>},</span>  <span class=c1>-- Cloudflare</span>
            <span class=n>retrans</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span>  <span class=c1>-- 5 retransmissions on receive timeout</span>
            <span class=n>timeout</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>  <span class=c1>-- 1 sec</span>
        <span class=p>}</span>
        <span class=kr>if</span> <span class=ow>not</span> <span class=n>r</span> <span class=kr>then</span>
            <span class=n>ngx</span><span class=p>.</span><span class=n>log</span><span class=p>(</span><span class=n>ngx</span><span class=p>.</span><span class=n>ERR</span><span class=p>,</span> <span class=s2>"failed to instantiate resolver: "</span><span class=p>,</span> <span class=n>err</span><span class=p>)</span>
            <span class=kr>return</span>
        <span class=kr>end</span>

        <span class=c1>-- Pull DNS â¦</span></pre></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=nginx,openresty,lua> <meta itemprop=keywords content=misc> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2020-08-09T17:00:00+01:00 itemprop=datePublished> 09 Aug 2020 </time>&nbsp;-- 3 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2020/08/09/retrying-dynamically-configured-upstreams-with-openresty/ rel=bookmark title="Permalink to 'Retrying dynamically configured upstreams withÂ OpenResty'" itemprop=url> Retrying dynamically configured upstreams with&nbsp;OpenResty </a> </h2> <section itemprop=articleBody class=summary-content> <div class=section id=preamble> <h2>Preamble</h2> <p>OpenResty is a modified version of nginx with LuaJIT compiled in and many nginx options that can be controlled or modified via Lua. It is very commonly used in content delivery networks for itâsÂ configurability.</p> <p>As such, we use OpenResty and one of the features we use is the ability to dynamically modify upstream backends. To achieve this we use some logic within OpenResty to update upstreams based on <span class=caps>DNS</span> records. This means we can pull upstreams in and out of service via <span class=caps>DNS</span> records and have OpenResty update itâs upstream proxy passing configuration without needing to push configs out to hundreds of servers and reloadÂ daemons.</p> <p>The logic behind how we update the upstream backends is beyond the scope of this post, so letâs just say we have a table of upstreamÂ servers.</p> <pre class="code lua literal-block">
<span class=kd>local</span> <span class=n>upstream_servers</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>"10.0.0.1:443"</span><span class=p>,</span>
    <span class=s2>"10.0.0.2 â¦</span></pre></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=debian,ubuntu,nginx,spdy,pagespeed,ngx_pagespeed> <meta itemprop=keywords content="deb builds"> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2014-02-06T03:30:00+00:00 itemprop=datePublished> 06 Feb 2014 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2014/02/06/nnginx-1.5.10-with-spdy3.1/ rel=bookmark title="Permalink to 'nginx 1.5.10 with SPDYÂ 3.1'" itemprop=url> nginx 1.5.10 with <span class=caps>SPDY</span>&nbsp;3.1 </a> </h2> <section itemprop=articleBody class=summary-content> <p>I have built and released nginx 1.5.10 with <span class=caps>SPDY</span> 3.1. Like the <a href=/2014/02/02/nginx-1.5.9-and-ngx_pagespeed-1.7.30.3-beta/ class="reference external">nginx 1.5.9 release</a> , this release comes with ngx_pagespeed 1.7.30.3-beta and is available on <a class="reference external" href=https://apt.kura.gg>apt.kura.gg</a> or as downloadsÂ below.</p> <div class=section id=manual-download> <h2>ManualÂ download</h2> <table class=docutils> <tbody> <tr><td><a class="reference external" href=/files/nginx_1.5.10_all.deb>nginx_1.5.10_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-common_1.5.10_all.deb>nginx-common_1.5.10_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-doc_1.5.10_all.deb>nginx-doc_1.5.10_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-light_1.5.10_amd64.deb>nginx-light_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-full_1.5.10_amd64.deb>nginx-full_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-extras_1.5.10_amd64.deb>nginx-extras_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi_1.5.10_amd64.deb>nginx-naxsi_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi-ui_1.5.10_all.deb>nginx-naxsi-ui_1.5.10_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-light-dbg_1.5.10_amd64.deb>nginx-light-dbg_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-full-dbg_1.5.10_amd64.deb>nginx-full-dbg_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-extras-dbg_1.5.10_amd64.deb>nginx-extras-dbg_1.5.10_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi-dbg_1.5.10_amd64.deb>nginx-naxsi-dbg_1.5.10_amd64.deb</a></td> </tr> </tbody> </table> </div> <div class=section id=md5> <h2><span class=caps>MD5</span></h2> <div class=highlight><pre><span></span>9fe2e5273cc195161268f7d85261c4e2  nginx_1.5.10_all.deb
edc55aa4866036eade02cd49957a9126  nginx-common_1.5.10_all.deb
0361cdb3d00ac6e65c5e9d6167ba0d36  nginx-doc_1.5.10_all.deb
833264c08fc6212f55ae37c26bd5cbc5  nginx-light_1.5.10_amd64.deb
c5c1ffa0dd93673ac4a859a11d1b3b50  nginx-full_1.5.10_amd64 â¦</pre></div></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=debian,ubuntu,haproxy,nginx,spdy,pagespeed,ngx_pagespeed> <meta itemprop=keywords content="deb builds"> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2014-02-02T17:54:00+00:00 itemprop=datePublished> 02 Feb 2014 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2014/02/02/nginx-1.5.9-and-ngx_pagespeed-1.7.30.3-beta/ rel=bookmark title="Permalink to 'nginx 1.5.9 and ngx_pagespeedÂ 1.7.30.3-beta'" itemprop=url> nginx 1.5.9 and ngx_pagespeed&nbsp;1.7.30.3-beta </a> </h2> <section itemprop=articleBody class=summary-content> <p>I have built and released nginx 1.5.9 with ngx_pagespeed module 1.7.30.3-beta and published them on <a class="reference external" href=https://apt.kura.gg>apt.kura.gg</a>.</p> <div class=section id=manual-download-install> <h2>Manual download <span class=amp>&amp;</span>Â install</h2> <table class=docutils> <tbody> <tr><td><a class="reference external" href=/files/nginx_1.5.9_all.deb>nginx_1.5.9_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-common_1.5.9_all.deb>nginx-common_1.5.9_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-doc_1.5.9_all.deb>nginx-doc_1.5.9_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-light_1.5.9_amd64.deb>nginx-light_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-full_1.5.9_amd64.deb>nginx-full_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-extras_1.5.9_amd64.deb>nginx-extras_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi_1.5.9_amd64.deb>nginx-naxsi_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi-ui_1.5.9_all.deb>nginx-naxsi-ui_1.5.9_all.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-light-dbg_1.5.9_amd64.deb>nginx-light-dbg_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-full-dbg_1.5.9_amd64.deb>nginx-full-dbg_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-extras-dbg_1.5.9_amd64.deb>nginx-extras-dbg_1.5.9_amd64.deb</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-naxsi-dbg_1.5.9_amd64.deb>nginx-naxsi-dbg_1.5.9_amd64.deb</a></td> </tr> </tbody> </table> </div> <div class=section id=md5> <h2><span class=caps>MD5</span></h2> <div class=highlight><pre><span></span>e3595519df9865941f0bd5c2c28bba18  nginx_1.5.9_all.deb
b2f3e4dcded2ce419175be8f4329b81e  nginx-common_1.5.9_all.deb
379ea6ad2805f3584609617deb5d1db9  nginx-doc_1.5.9_all.deb
140247350a651b24bde7278ce1f18148  nginx-light_1.5.9_amd64.deb
0a28a4965f00a5e739187aa81a16af3f  nginx-full_1.5.9_amd64.deb
e54ab6b670cfe7d56502ef08b6e2656f  nginx-extras_1.5.9_amd64.deb
9bb9b524c523a69f9f263eefbe5f5783  nginx-naxsi_1.5.9_amd64.deb
7b8e254515d3b6f90b8e55c720d314b8 â¦</pre></div></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=debian,ubuntu,haproxy,nginx,spdy,pagespeed,ngx_pagespeed> <meta itemprop=keywords content="deb builds"> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2014-01-08T13:00:00+00:00 itemprop=datePublished> 08 Jan 2014 </time>&nbsp;-- 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2014/01/08/haproxy1.5-dev21-nginx-1.5.8-spdy-pagespeed-1.7.30.2/ rel=bookmark title="Permalink to 'haproxy1.5-dev21, nginx 1.5.8, SPDY & pagespeedÂ 1.7.30.2'" itemprop=url> haproxy1.5-dev21, nginx 1.5.8, <span class=caps>SPDY</span> <span class=amp>&amp;</span> pagespeed&nbsp;1.7.30.2 </a> </h2> <section itemprop=articleBody class=summary-content> <p>I have previously released <a href=/2013/07/15/haproxy-nginx-and-spdy-with-ssl-termination-debian-7/ class="reference external">haproxy1.5-dev19 with <span class=caps>SSL</span> <span class=amp>&amp;</span> <span class=caps>SPDY</span> support enabled</a> and <a href=/2013/07/10/nginx-spdy-and-ngx-pagespeed/ class="reference external">nginx 1.4.1 with <span class=caps>SPDY</span> support and pagespeed</a>, although I do not remember which version ofÂ pagespeed.</p> <p>I have received a few messages asking me for the latest version of haproxy, nginx and pagespeed so I decided to finally build and releaseÂ them.</p> <div class=section id=requirements> <h2>Requirements</h2> <p>haproxy requires openssl-1.0.1d orÂ higher.</p> <p>On a standard Debian 7 install you should have openssl-1.0.1e-2, you can find which version you have byÂ running</p> <div class=highlight><pre><span></span>dpkg -l openssl
</pre></div> <p>This should return something similarÂ to</p> <pre class=literal-block>
ii  openssl        1.0.1e-2        amd64        Secure Socket Layer (SSL) binary and related cryptographic tools
</pre> </div> <div class=section id=build-notes> <h2>BuildÂ notes</h2> <p>Builds were done on Debian 7 <span class=caps>AMD64</span>, I will not be providing 32bit versions as this is mainly for my own usage andÂ amusement.</p> </div> <div class=section id=haproxy> <h2>haproxy</h2> <p>This haproxy build is compiled against openssl, providing the npn module, allowing for haproxy â¦</p></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content="debian,ubuntu,haproxy,nginx,spdy,ssl,ssl termination"> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2013-07-15T22:30:00+01:00 itemprop=datePublished> 15 Jul 2013 </time>&nbsp;-- 5 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2013/07/15/haproxy-nginx-and-spdy-with-ssl-termination-debian-7/ rel=bookmark title="Permalink to 'haproxy, nginx and SPDY with SSL termination (DebianÂ 7)'" itemprop=url> haproxy, nginx and <span class=caps>SPDY</span> with <span class=caps>SSL</span> termination (Debian&nbsp;7) </a> </h2> <section itemprop=articleBody class=summary-content> <p><a href=/2013/07/10/nginx-spdy-and-ngx-pagespeed/ class="reference external">I wrote an article last week</a> explaining that I had changed my blog and built my own nginx packages with <a class="reference external" href=https://www.chromium.org/spdy><span class=caps>SPDY</span></a> builtÂ in.</p> <p>I decided I would take things a little further and poke around with haproxy some more. The initial plan was to compile the latest dev source of haproxy with <span class=caps>SSL</span> terminationÂ enabled.</p> <p>In doing so I realised I would lose <span class=caps>SPDY</span> support, which upset me a little. After some digging I found that the 1.5-dev branch of haproxy supports npn and thus can handle <span class=caps>SPDY</span>.</p> <p>I tweaked my builds a little more and managed to get haproxy running as an <span class=caps>SSL</span> terminating load balancer, with <span class=caps>SPDY</span> connections being sent off to my nginx servers with <span class=caps>SPDY</span> enabled and all other non-<span class=caps>SPDY</span> connections were passed on to an nginx virtual host with <span class=caps>SPDY</span>Â disabled.</p> <div class=section id=requirements> <h2>Requirements</h2> <p>I have released my haproxy build as a debian file below â¦</p></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=debian,ubuntu,nginx,spdy,pagespeed,ngx_pagespeed,mod_pagespeed> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2013-07-10T22:30:00+01:00 itemprop=datePublished> 10 Jul 2013 </time>&nbsp;-- 2 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2013/07/10/nginx-spdy-and-ngx-pagespeed/ rel=bookmark title="Permalink to 'nginx, SPDY and ngx_pagespeedÂ (Debian/Ubuntu)'" itemprop=url> nginx, <span class=caps>SPDY</span> and ngx_pagespeed&nbsp;(Debian/Ubuntu) </a> </h2> <section itemprop=articleBody class=summary-content> <p>I decided to rebuild syslog.tv as pure <span class=caps>HTML</span> using <span class=caps>RST</span> and <a href=https://blog.getpelican.com/ class="reference external">Pelican</a> and rebrand it asÂ kura.gg.</p> <p>In doing so I decided I would go all out and use <a class="reference external" href=https://www.chromium.org/spdy><span class=caps>SPDY</span></a> and <a class="reference external" href=https://nginx.org/en/docs/http/ngx_http_spdy_module.html>ngx_pagespeed</a> (<a href=https://developers.google.com/speed/ class="reference external">mod_pagespeed</a>) for fun to see exactly what I couldÂ do.</p> <p>Sadly no version of nginx has been officially released with <span class=caps>SPDY</span> or ngx_pagespeed enabled, you can compile nginx from source to enable <span class=caps>SPDY</span> so I thought I would go ahead and do it, releasing some Debian packages in theÂ process.</p> <p>After compiling nginx from the source package available at the <a class="reference external" href=https://launchpad.net/~nginx>Ubuntu <span class=caps>PPA</span></a>, I decided I would go further and compile inÂ ngx_pagespeed.</p> <div class=section id=installing> <h2>Installing</h2> <p>I have released the 4 required debian packages below (please note they are only available forÂ amd64);</p> <table class=docutils> <thead> <tr><th class=head><span class=caps>FILE</span></th> <th class=head><span class=caps>GPG</span></th> <th class=head><span class=caps>MD5</span></th> <th class=head><span class=caps>SHA1</span></th> </tr> </thead> <tbody> <tr><td><a class="reference external" href=/files/nginx_1.4.1_all.deb>nginx_1.4.1_all.deb</a></td> <td><a class="reference external" href=/files/nginx_1.4.1_all.deb.asc>owGMl1NwLwâ¦</a></td> <td><a class="reference external" href=/files/nginx_1.4.1_all.deb.md5>42f790a1f6â¦</a></td> <td><a class="reference external" href=/files/nginx_1.4.1_all.deb.sha1>f4495055e9â¦</a></td> </tr> <tr><td><a class="reference external" href=/files/nginx-common_1.4.1_all.deb>nginx-common_1.4.1_all.deb</a></td> <td><a class="reference external" href=/files/nginx-common_1.4.1_all.deb.asc>owGMt1NwJUâ¦</a></td> <td><a class="reference external" href=/files/nginx-common_1.4.1_all.deb.md5>ca4ec5688dâ¦</a></td> <td><a class="reference external" href=/files/nginx-common_1.4.1_all.deb.sha1>633bfc2eaa â¦</a></td></tr></tbody></table></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache2,nginx,wordpress,wp-super-cache> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2011-09-30T23:21:00+01:00 itemprop=datePublished> 30 Sep 2011 </time>&nbsp;-- 2 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2011/09/30/nginx-config-for-reverse-proxying-wordpress-wp-super-cache-and-keeping-the-load-off-apache2/ rel=bookmark title="Permalink to 'nginx config for reverse proxying Wordpress & WP Super Cache and keeping the load offÂ Apache2'" itemprop=url> nginx config for reverse proxying Wordpress <span class=amp>&amp;</span> <span class=caps>WP</span> Super Cache and keeping the load off&nbsp;Apache2 </a> </h2> <section itemprop=articleBody class=summary-content> <div class=section id=the-point> <h2>TheÂ point</h2> <p>The whole point of this is to get as much load off of Apache as possible to keep the server running nice andÂ smoothly.</p> </div> <div class=section id=configuration> <h2>Configuration</h2> <p>The configuration below will mean that nginx will serve basicallyÂ everything;</p> <ul class=simple> <li>staticÂ files</li> <li>uploaded filesÂ and</li> <li>cachedÂ content</li> </ul> <p>simply replace the <strong><span class=caps>VARIABLES</span></strong> below and everything should be good to go, if copy-pasting from below isnât working properly you can download a full copy from <a class="reference external" href=/files/2011/09/server.txt>here</a>.</p> <div class=highlight><pre><span></span><span class=k>server</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>server_name</span><span class=w> </span><span class=s>**DOMAIN_HERE**</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.**DOMAIN_HERE**.log</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kn>gzip</span><span class=w> </span><span class=no>on</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>gzip_disable</span><span class=w> </span><span class=s>msie6</span><span class=p>;</span><span class=w> </span><span class=c1># disable gzip for IE6</span>
<span class=w>  </span><span class=kn>gzip_static</span><span class=w> </span><span class=no>on</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>gzip_comp_level</span><span class=w> </span><span class=mi>9</span><span class=p>;</span><span class=w> </span><span class=c1># highest level of compression</span>
<span class=w>  </span><span class=kn>gzip_proxied</span><span class=w> </span><span class=s>any</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>gzip_types</span><span class=w> </span><span class=s>text/plain</span><span class=w> </span><span class=s>text/css</span><span class=w> </span><span class=s>application/x-javascript</span><span class=w> </span><span class=s>text/xml</span><span class=w> </span><span class=s>application/xml</span><span class=w> </span><span class=s>application/xml+rss</span><span class=w> </span><span class=s>text/javascript</span><span class=p>;</span><span class=w></span>

<span class=w>  </span><span class=kn>proxy_redirect</span><span class=w> </span><span class=no>off</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x â¦</span></pre></div></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content="apache,load balancer,nginx,pound,reaip,x-forwarded-for"> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2011-08-10T12:34:00+01:00 itemprop=datePublished> 10 Aug 2011 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2011/08/10/nginx-log-real-ip-from-pound/ rel=bookmark title="Permalink to 'nginx log real IP fromÂ Pound'" itemprop=url> nginx log real <span class=caps>IP</span> from&nbsp;Pound </a> </h2> <section itemprop=articleBody class=summary-content> <p>Recently I started using Pound as a load balancer to a cluster of nginx servers and found my access logs were filled with the <span class=caps>IP</span> address of the load balancer. I did some digging and found the correct way to âfixâÂ this.</p> <p>First thing you need to do is make sure you remove X-Forwarded-For fromÂ Pound</p> <pre class=literal-block>
ListenHTTP
    # ... snip ...
    # ... snip ...
    HeadRemove "X-Forwarded-For"
End
</pre> <p>Once this is done, reloadÂ Pound.</p> <p>Next you need nginx compiled with realip module - <a class="reference external" href=https://wiki.nginx.org/NginxHttpRealIpModule>https://wiki.nginx.org/NginxHttpRealIpModule</a></p> <p>On Ubuntu/Debian servers this module comes by default, otherwise you may have to compile it in yourself using the followingÂ option:</p> <div class=highlight><pre><span></span>--with-http_realip_module
</pre></div> <p>Once this is all done modify your nginx vhosts and add the following 2Â lines</p> <div class=highlight><pre><span></span><span class=k>set_real_ip_from</span><span class=w> </span><span class=s>[IP]</span><span class=p>;</span><span class=w></span>
<span class=k>real_ip_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=p>;</span><span class=w></span>
</pre></div> <p>Where [<span class=caps>IP</span>] is the <span class=caps>IP</span> address of your loadÂ balancer.</p> <p>To configure this to work with Apache you need the â¦</p> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content="google analytics,logging,nginx"> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2011-06-05T20:41:00+01:00 itemprop=datePublished> 05 Jun 2011 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2011/06/05/logging-google-analytics-cookies-with-nginx/ rel=bookmark title="Permalink to 'Logging Google Analytics cookies withÂ nginx'" itemprop=url> Logging Google Analytics cookies with&nbsp;nginx </a> </h2> <section itemprop=articleBody class=summary-content> <p>I was recently tasked with adding Google tracking cookies to our nginx logging for a couple of sites. It was so it could be pushed through a logÂ processor.</p> <p>It turned out too be a little trickier than it would have been with Apache, but the process itself is still quiteÂ simple.</p> <p>Open up the server definition you wish to add it to and add a custom log format likeÂ below</p> <pre class=literal-block>
log_format g-a '$remote_addr - $remote_user [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent" ' '"__utma=$cookie___utma;__utmb=$cookie___utmb;__utmc=$cookie___utmc;__utmv=$cookie___utmv;__utmz=$cookie_umtz"';
</pre> <p>This log format can then be added to your access log likeÂ below:</p> <div class=highlight><pre><span></span><span class=k>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.example.com.log</span><span class=w> </span><span class=s>g-a</span><span class=p>;</span><span class=w></span>
</pre></div> <p>ReloadÂ nginx</p> <div class=highlight><pre><span></span>sudo /etc/init.d/nginx reload
</pre></div> <p>If all goes well, you should see Google Analytics appearing in your access logs â¦</p> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,nginx,varnish,wordpress> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-09-26T19:41:00+01:00 itemprop=datePublished> 26 Sep 2010 </time>&nbsp;-- 6 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/09/26/nginx-varnish-apache2/ rel=bookmark title="Permalink to 'WordPress + nginx + Varnish + ApacheÂ 2'" itemprop=url> WordPress + nginx + Varnish + Apache&nbsp;2 </a> </h2> <section itemprop=articleBody class=summary-content> <p>Lately Iâve been doing a lot of work with Varnish, this includes testing it within a load balanced environment, putting it behind nginx, putting it in front of Solr, the list goesÂ on.</p> <p>This blog post will hopefully give you an insight in to a simple way of combining nginx, Varnish and Apache to create a powerful Wordpress environment that can really take aÂ hammering.</p> <p>Iâm going to assume you already have Apache and nginx working together, if not I suggest you read my other articles on these subjects to learn how to combineÂ them.</p> <div class=section id=installing-varnish> <h2>InstallingÂ Varnish</h2> <div class=highlight><pre><span></span>sudo apt-get install varnish
</pre></div> </div> <div class=section id=configuring-apache> <h2>ConfiguringÂ Apache</h2> <p>I suggest binding Apache to port 81, this is easy to change, open the following file in your favouriteÂ editor.</p> <blockquote> /etc/apache2/ports.conf</blockquote> <p>Change the Listen and NameVirtualHost linesÂ to:</p> <div class=highlight><pre><span></span><span class=nb>Listen</span><span class=w> </span><span class=m>81</span><span class=w></span>
<span class=nb>NameVirtualHost</span><span class=w> </span>*:81<span class=w></span>
</pre></div> <p>This will mean you need to go and change all â¦</p></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,cache,nginx,proxy,proxy_cache,wordpress> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-04-18T12:51:00+01:00 itemprop=datePublished> 18 Apr 2010 </time>&nbsp;-- 4 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/04/18/new-syslog-tv-nginx-wordpress-site-configuration/ rel=bookmark title="Permalink to 'New syslog.tv nginx wordpress site configurationÂ explained'" itemprop=url> New syslog.tv nginx wordpress site configuration&nbsp;explained </a> </h2> <section itemprop=articleBody class=summary-content> <div class=section id=configuration-changes> <h2>ConfigurationÂ changes</h2> <p>I made some modifications to my nginx configuration this weekend to improve performance and clear up someÂ bugs.</p> <div class=highlight><pre><span></span><span class=k>upstream</span><span class=w> </span><span class=s>backend</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>81</span><span class=w> </span><span class=s>fail_timeout=120s</span><span class=p>;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=k>server</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>syslog.tv</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=kn>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.syslog.tv.log</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=kn>gzip</span><span class=w> </span><span class=no>on</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>gzip_disable</span><span class=w> </span><span class=s>msie6</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>gzip_static</span><span class=w> </span><span class=no>on</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>gzip_comp_level</span><span class=w> </span><span class=mi>9</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>gzip_proxied</span><span class=w> </span><span class=s>any</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=kn>gzip_types</span><span class=w> </span><span class=s>text/plain</span><span class=w> </span><span class=s>text/css</span><span class=w> </span><span class=s>application/x-javascript</span><span class=w> </span><span class=s>text/xml</span><span class=w></span>
<span class=w>    </span><span class=s>application/xml</span><span class=w> </span><span class=s>application/xml+rss</span><span class=w> </span><span class=s>text/javascript</span><span class=p>;</span><span class=w></span>

<span class=w>   </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/var/www/syslog.tv</span><span class=p>;</span><span class=w></span>

<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$wordpress_logged_in</span><span class=w> </span><span class=s>""</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author_email</span><span class=w> </span><span class=s>""</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author</span><span class=w> </span><span class=s>""</span><span class=p>;</span><span class=w></span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"wordpress_logged_in_[^=]*=([^%]+)%7C")</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>             </span><span class=kn>set</span><span class=w> </span><span class=nv>$wordpress_logged_in</span><span class=w> </span><span class=s>wordpress_logged_in_</span><span class=nv>$1</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"comment_author_email_[^=]*=([^</span><span class=p>;</span><span class=kn>]+)(</span><span class=p>;</span><span class=kn>|$)")</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author_email</span><span class=w> </span><span class=s>comment_author_email_</span><span class=nv>$1</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"comment_author_[^=]*=([^</span><span class=p>;</span><span class=kn>]+)(</span><span class=p>;</span><span class=kn>|$)")</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author</span><span class=w> </span><span class=s>comment_author_</span><span class=nv>$1</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>

<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$my_cache_key</span><span class=w> </span><span class=s>"</span><span class=nv>$scheme://$host$uri$is_args$args$wordpress_logged_in$comment â¦</span></pre></div></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=debian,fedora,install,nginx,redhat,ubuntu> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-04-02T16:54:00+01:00 itemprop=datePublished> 02 Apr 2010 </time>&nbsp;-- 4 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/04/02/building-nginx-on-red-hat-and-debian-to-rpmdeb-style-locations/ rel=bookmark title="Permalink to 'Building nginx on Red Hat and Debian to RPM/DEB-styleÂ locations'" itemprop=url> Building nginx on Red Hat and Debian to <span class=caps>RPM</span>/<span class=caps>DEB</span>-style&nbsp;locations </a> </h2> <section itemprop=articleBody class=summary-content> <p>The title of this post is a bit stupid, but I honestly couldnât think of any other way to writeÂ itâ¦</p> <p>When compiling nginx by hand, by default make install will push the binaries out to /usr/local/nginx and it doesnât come with a start/stop script, understandably because it doesnât know which <span class=caps>OS</span> it is going to be installed on etcÂ etc.</p> <p>Recently I was tasked with building nginx to an old Red Hat Enterprise Live 4 server with no yum installation, no nginx package in up2date and not being able to find an <span class=caps>RPM</span> thatâs link wasnâtÂ dead.</p> <p>Iâve always felt that, being a Debian user, people think of me as only being able to use apt-get and if Iâm feeling especially adventurous dpkg - to install applications. Some people know that I build .deb files in my spare time, but â¦</p> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,log,nginx,proxy> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-03-20T19:24:00+00:00 itemprop=datePublished> 20 Mar 2010 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/03/20/show-ip-in-apache-logs-from-nginx-reverse-proxy/ rel=bookmark title="Permalink to 'Show IP in Apache logs from nginx reverseÂ proxy'" itemprop=url> Show <span class=caps>IP</span> in Apache logs from nginx reverse&nbsp;proxy </a> </h2> <section itemprop=articleBody class=summary-content> <p>This is a very quick blog to show you how to show a users <span class=caps>IP</span> address in your Apache access logs when the site in question is being reverse proxied to Apache throughÂ nginx.</p> <p>You need the rpaf module for Apache, on Debian and Ubuntu this is simple toÂ install</p> <div class=highlight><pre><span></span>sudo apt-get install libapache2-mod-rpaf
sudo a2enmod rpaf
sudo /etc/init.d/apache2 restart
</pre></div> <p>This set of commands will do theÂ following;</p> <ol class="arabic simple"> <li>Update apt packageÂ list</li> <li>InstallÂ libapache2-mod-rpaf</li> <li>EnableÂ mod-rpaf</li> <li>Gracefully restart Apache (doesnât killÂ connections)</li> </ol> <p>Once installed you simple need to be sure to pass the correct headers through, so open up one of your nginx site configuration files and add the following within the serverÂ definition.</p> <div class=highlight><pre><span></span><span class=k>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span><span class=w></span>
</pre></div> <p>So you should have something that looks like this, but without the ââ¦ snipÂ â¦â</p> <div class=highlight><pre><span></span><span class=k>server</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=c1># ...snip...</span>
<span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=c1># ...snip...</span>
<span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add â¦</span></pre></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=nginx> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-03-18T21:54:00+00:00 itemprop=datePublished> 18 Mar 2010 </time>&nbsp;-- < 1 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/03/18/nginx-increase-increase-server_names_hash_bucket_size/ rel=bookmark title="Permalink to 'nginx - increase increaseÂ server_names_hash_bucket_size'" itemprop=url> nginx - increase increase&nbsp;server_names_hash_bucket_size </a> </h2> <section itemprop=articleBody class=summary-content> <p>Today I ran in to something Iâd never seen before when configuringÂ nginx.</p> <p>I ran the nginx config test, as I usually do before I restartÂ it.</p> <div class=highlight><pre><span></span>nginx -t
</pre></div> <p>But, the response I got wasÂ interesting</p> <pre class=literal-block>
2010/03/18 21:16:09 [emerg] 12299#0: could not build the server_names_hash, you should increase server_names_hash_bucket_size: 32
2010/03/18 21:16:09 [emerg] 12299#0: the configuration file /etc/nginx/nginx.conf test failed
</pre> <p>I found that one of the domain names I was using was over 32 characters in length, nginxâs default maxÂ length.</p> <p>Thankfully the fix wasÂ simple.</p> <div class=highlight><pre><span></span><span class=k>http</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=c1># ...snip...</span>
<span class=w>    </span><span class=kn>server_names_hash_bucket_size</span><span class=w> </span><span class=mi>64</span><span class=p>;</span><span class=w></span>
<span class=w>    </span><span class=c1># ...snip...</span>
<span class=p>}</span><span class=w></span>
</pre></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content="apache,cache,debian,howto,load balancing,nginx,ubuntu,wordpress"> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-02-14T14:27:00+00:00 itemprop=datePublished> 14 Feb 2010 </time>&nbsp;-- 4 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/02/14/more-nginx-proxy_cache-optimizations-and-nginx-load-balancing/ rel=bookmark title="Permalink to 'More nginx proxy_cache optimizations and nginx loadÂ balancing'" itemprop=url> More nginx proxy_cache optimizations and nginx load&nbsp;balancing </a> </h2> <section itemprop=articleBody class=summary-content> <p>This is yet another follow up to post to several previous posts about using nginx as a reverse proxy with caching. It is actually a direct addition to my post from a week or so ago which outlined how to actually using nginxâs proxy caching feature which can be read here â <a href=https://syslog.tv/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/ class="reference external">/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/</a>.</p> <div class=section id=even-more-changes> <h2>Even moreÂ changes?</h2> <p>Yes, even more changes, these are basic changes that are there to improve the caching capabilities and also implement loadÂ balancing.</p> <div class=section id=cache-changes> <h3>CacheÂ changes</h3> <p>The first set of changes are in the main nginx configurationÂ file</p> <blockquote> /etc/nginx/nginx.conf</blockquote> <p>These changes basically just change the proxy_cacheÂ key</p> <div class=highlight><pre><span></span><span class=k>proxy_cache_path</span><span class=w> </span><span class=s>/var/www/nginx_cache</span><span class=w> </span><span class=s>levels=1:2</span><span class=w> </span><span class=s>keys_zone=cache:8m</span><span class=w> </span><span class=s>max_size=1000m</span><span class=w> </span><span class=s>inactive=600m</span><span class=p>;</span><span class=w></span>
<span class=k>proxy_temp_path</span><span class=w> </span><span class=s>/tmp/nginx</span><span class=p>;</span><span class=w></span>
<span class=k>proxy_cache_key</span><span class=w> </span><span class=s>"</span><span class=nv>$scheme://$host$request_uri"</span><span class=p>;</span><span class=w></span>
</pre></div> <p>Iâve decided to put the temporary caches file in to â¦</p></div></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,cache,debian,howto,nginx,php,ubuntu,wordpress> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-02-07T10:27:00+00:00 itemprop=datePublished> 07 Feb 2010 </time>&nbsp;-- 7 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/ rel=bookmark title="Permalink to 'nginx, proxy_cache and reverse proxying explained &Â benchmarked'" itemprop=url> nginx, proxy_cache and reverse proxying explained <span class=amp>&amp;</span>&nbsp;benchmarked </a> </h2> <section itemprop=articleBody class=summary-content> <div class=section id=the-beginning> <h2>TheÂ beginning</h2> <p>Where to begin? nginx would be a good start I suppose. Itâs far easier and makes much for sense for you to actually read about nginx from itâs own website - <a href=https://nginx.org/en/ class="reference external">https://nginx.org/en/</a> - but just to give a simple explanation too; `nginx is king of static content <span class=caps>HTTP</span>Â servers.`</p> <p>Anyone that has dealt with Apache on medium to high traffic websites will know that Apache is bit of a `wheezy, old geezer` when it comes to content serving using itâs mpm-worker (threaded). Very often high traffic will cause server load to go through the roof but for serving dynamic content, there really is no better <span class=caps>HTTP</span> server than Apache, so this leaves us in a bit of a predicament; a high powered website with dynamic content and lots of static files like <span class=caps>JS</span>, <span class=caps>CSS</span> and imagery, what do weÂ do?!</p> <p>In this example `dynamic â¦</p></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,cache,nginx,varnish> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-02-06T10:36:00+00:00 itemprop=datePublished> 06 Feb 2010 </time>&nbsp;-- 4 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/02/06/using-nginx-varnish-and-apache/ rel=bookmark title="Permalink to 'Using nginx, Varnish andÂ Apache'" itemprop=url> Using nginx, Varnish and&nbsp;Apache </a> </h2> <section itemprop=articleBody class=summary-content> <div class=section id=the-problem> <h2>TheÂ problem</h2> <p>So lets get to the problem first. I have several lightly to medium loaded sites running on some virtual servers, they servers themselves are highly configured to run beautifully on our host environments, very, very <span class=caps>RAM</span> intensive but low disk I/O and low <span class=caps>CPU</span>Â usage.</p> <p>As mentioned, the sites are relatively low loaded, theyâll generally hang around at between 3,000-5,000 unique hits a day and are run through Apache using <span class=caps>PHP</span>, various <span class=caps>PHP</span> modules and MySQL, a simple generic <span class=caps>LAMP</span> environment, yet customised to suit itâs surroundings andÂ host.</p> <p>The sites themselves run fine on that setup, no issues at all on normal days, but on set days of the week these sites can double in unique hits or even more than double, with KeepAlive enabled and a KeepAliveTimeout set low Apache has problems handling this kind of load (I should point out â¦</p></div> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,cache,debian,nginx,wordpress> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-01-12T00:37:00+00:00 itemprop=datePublished> 12 Jan 2010 </time>&nbsp;-- 2 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/01/12/apache-2-nginx-wordpress-mu-follow-up/ rel=bookmark title="Permalink to 'Apache 2, Nginx & WordPress MU - FollowÂ up'" itemprop=url> Apache 2, Nginx <span class=amp>&amp;</span> WordPress <span class=caps>MU</span> - Follow&nbsp;up </a> </h2> <section itemprop=articleBody class=summary-content> <p>This is a quick follow up to a previous post about getting this blog <a href=/2010/01/11/debian-apache-2-nginx-wordpress-mu/ class="reference external">running on nginx with a reverse proxy to Apache 2</a>.</p> <p>It seems the issue stems from 3 mods I had installed andÂ enabled</p> <ol class="arabic simple"> <li>mod-spamhaus</li> <li>mod-evasiveÂ and</li> <li>mod-security</li> </ol> <p>The 3, when running together are a fantastic way to strengthen any web server from attack, be it <span class=caps>DOS</span>, injection, <span class=caps>XLS</span> etc. Iâve sworn by all 3 of them for years now and I thought I had them cracked for security:performance ratio, when it comes to reverse proxying requests from nginx to Apache 2 where WordPress is concerned, apparently I was veryÂ wrong.</p> <p>The issue wasnât so bad when the cache was full, but seeing as my cache is only alive for an hour that leaves an open point for the cache to be recreated when a user views the page. This in itself isnât â¦</p> </section> <div class="eevee-divider mdl-color--accent" role=presentation></div> <div class=eevee-divider-to-top> <a href=#top title="Back to the top of the page" itemprop=url> Back to the top of the page </a> </div> </article> <article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting> <meta itemprop=accessibilityControl content=fullKeyboardControl> <meta itemprop=accessibilityControl content=fullMouseControl> <meta itemprop=accessibilityControl content=bookmarks> <meta itemprop=accessibilityControl content=captions> <meta itemprop=accessibilityControl content=alternativeText> <meta itemprop=accessibilityControl content=index> <meta itemprop=accessibilityControl content=readingOrder> <meta itemprop=accessibilityControl content=structuralNavigation> <meta itemprop=accessibilityControl content=tableOfContents> <meta itemprop=accessibilityHazard content=noFlashingHazard> <meta itemprop=accessibilityHazard content=noMotionSimulationHazard> <meta itemprop=accessibilityHazard content=noSoundHazard> <meta itemprop=accessibilityAPI content=ARIA> <div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation /> <a href=https://kura.gg/authors/kura/ class=hidden itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a> </div> <meta itemprop=keywords content=apache,cache,debian,nginx,wordpress> <meta itemprop=keywords content=tutorials> <div class="eevee-meta mdl-color-text--grey-500"> <time datetime=2010-01-11T19:58:00+00:00 itemprop=datePublished> 11 Jan 2010 </time>&nbsp;-- 5 min read </div> <h2 itemprop=name class=article-title> <a href=https://kura.gg/2010/01/11/debian-apache-2-nginx-wordpress-mu/ rel=bookmark title="Permalink to 'Debian, Apache 2, Nginx, WordPress MU & WP-Super-Cache'" itemprop=url> Debian, Apache 2, Nginx, WordPress <span class=caps>MU</span> <span class=amp>&amp;</span> <span class=caps>WP</span>-Super-Cache </a> </h2> <section itemprop=articleBody class=summary-content> <p><em>This is a rather old article, for more up-to-date information pleaseÂ see;</em></p> <ol class="arabic simple"> <li><a href=/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/ class="reference external">/2010/02/07/nginx-proxy_cache-and-explained-benchmarked/</a></li> <li><a href=/2010/02/14/more-nginx-proxy_cache-optimizations-and-nginx-load-balancing/ class="reference external">/2010/02/14/more-nginx-proxy_cache-optimizations-and-nginx-load-balancing/</a></li> </ol> <p>Iâve started collecting a few blogs on my servers now and figured from this one on I would consolidate it in to one workable, usable location. Removing my need to update multiple plugins, themes and WordPress itself, over andÂ over.</p> <p>This time round I thought Iâd do it properly, and properly in my book is as complicated and âawesomeâ as it can possibly be, without growing legs and running off to stomp aÂ city.</p> <div class=section id=love> <h2>Love</h2> <p>Iâve fallen in-love with nginx (<a href=https://nginx.org/ class="reference external">https://nginx.org/</a>) over the last 6 months or so, Iâd been an avid user of LighTTPD for a very long time before but started to look in to nginx mid year as a replacement. I learned that at my new job they used â¦</p></div> </section> </article> <div class=eevee-page-spacer role=presentation></div> </div> </div> </main> <div class="eevee-pagination__container eevee-container mdl-grid"> <div role=presentation class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"> </div> <div class="mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"> <nav class="eevee-pagination mdl-cell mdl-cell--12-col" itemscope itemtype=http://schema.org/SiteNavigationElement aria-label=Pagination> <div class=eevee-spacer></div> </nav> </div> </div> <footer class=mdl-mega-footer itemscope itemtype=http://schema.org/SiteNavigationElement> <div class=mdl-mega-footer--top-section> <div class=mdl-mega-footer--drop-down-section> <ul class=mdl-mega-footer--link-list> <li> <a href=#top itemprop=url title="Back to the top of the page"> Back to the top of the page </a> </li> </ul> </div> </div> <div class=mdl-mega-footer--middle-section itemscope itemtype=http://schema.org/SiteNavigationElement aria-label="Footer navigation"> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Menu</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=/contact/ itemprop=url rel=bookmark title=Contact> <i class=material-icons aria-hidden=true>&#xE0B7;</i> Contact </a> </li> <li> <a href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>&#xE02F;</i> Archives </a> </li> <li> <a href=https://kura.gg/feeds/rss.xml title=RSS itemprop=url> <i class=material-icons>&#xE0E5;</i> RSS </a> </li> </ul> </div> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Social</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=https://github.com/kura itemprop=url rel=bookmark title=GitHub> <i class=fa aria-hidden=true>&#xF09B;</i> Github </a> </li> </ul> </div> <div class=mdl-mega-footer--drop-down-section> <h1 class=mdl-mega-footer--heading>Links</h1> <ul class=mdl-mega-footer--link-list> <li> <a href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i class=material-icons aria-hidden=true>&#xE86F;</i> Blackhole </a> </li> <li> <a href=/eevee itemprop=url rel=bookmark title=Eevee> <i class=material-icons aria-hidden=true>&#xE871;</i> Eevee </a> </li> <li> <a href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i class=material-icons aria-hidden=true>&#xE871;</i> Hauntr </a> </li> <li> <a href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i class=material-icons aria-hidden=true>&#xE871;</i> Ghastly </a> </li> <li> <a href=/pelican-plugins itemprop=url rel=bookmark title="Pelican Plugins"> <i class=material-icons aria-hidden=true>&#xE86F;</i> Pelican Plugins </a> </li> </ul> </div> </div> <div class=mdl-mega-footer--bottom-section> <div class=mdl-logo> <a href=https://kura.gg rel=bookmark itemprop=url title=kura.gg> kura.gg </a> </div> <ul class="eevee-footer mdl-mega-footer--link-list"> <li>Powered by love &amp; rainbow sparkles.</li> <li>Source code and content released under the <a href=/license/ title="MIT license">MIT license</a>.</li> </ul> </div> </footer> </div> </body> </html>