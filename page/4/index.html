<!doctype html><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0,minimum-scale=1.0 name=viewport><link href=https://kura.gg hreflang=en rel=alternate><link href=https://kura.gg rel=dns-prefetch><link href=https://kura.gg/theme/css/eevee.min.css?1c9d8344 rel=stylesheet><script async src=https://kura.gg/theme/js/eevee.min.js?1841d254></script><link href=https://kura.gg/feeds/rss.xml rel=alternate title=kura.gg type=application/rss+xml><link href=https://kura.gg/feeds/atom.xml rel=alternate title=kura.gg type=application/atom+xml><meta content=kura.gg property=og:site_name><meta content=article property=og:type><meta content=kura.gg property=og:title><meta content=https://kura.gg/page/4/index.html property=og:url><meta content=https://kura.gg/page/4/index.png property=og:image><meta content=1920 property=og:image:width><meta content=1080 property=og:image:height><meta content=kura.gg property=twitter:title><meta content=https://kura.gg/page/4/index.html property=twitter:url><meta content=https://kura.gg/page/4/index.png property=twitter:image><meta content=summary_large_image property=twitter:card><meta content=1920 property=twitter:image:width><meta content=1080 property=twitter:image:height><link sizes="16x16 32x32 48x48 64x64 128x128 256x256" href=/favicon.png rel=icon type=image/png><link sizes="16x16 32x32 48x48 64x64 128x128 256x256" href=/favicon.ico rel=icon type=image/vnd.microsoft.icon><title>kura.gg</title><body><div class="eevee-layout mdl-layout mdl-js-layout mdl-color--grey-50"><header class="eevee-header mdl-color--grey-50 mdl-color-text--grey-800" itemscope itemtype=http://schema.org/WPHeader><div class=mdl-layout__header-row><div class="mdl-layout__drawer-button mdl-color-text--accent eevee-mobile-button mdl-layout--small-screen-only" aria-expanded=false role=button tabindex=0><i class=material-icons></i></div><span class="eevee-logo mdl-color-text--accent mdl-layout-title"> <h2 id=top><a href=https://kura.gg rel=bookmark title=kura.gg> kura.gg </a></h2> </span><div class=mdl-layout-spacer role=presentation></div><nav aria-label="Header navigation" class="eevee-nav mdl-navigation mdl-layout--large-screen-only" itemscope itemtype=http://schema.org/SiteNavigationElement><a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons></i> Blackhole </a><a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons></i> Eevee </a><a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons></i> Hauntr </a><a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons></i> Ghastly </a><a class="mdl-color-text--accent mdl-navigation__link" title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons></i> Pelican Plugins </a><a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons></i> Contact </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons></i> Archives </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons></i> RSS </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons></i> Atom </a></nav></div></header><div class="eevee-mobile-header mdl-layout__drawer mdl-color--white" aria-hidden=true><span class=mdl-layout-title> <h2 class="eevee-mobile-logo mdl-color-text--accent">kura.gg</h2> </span><div class="mdl-navigation mdl-color--white"><nav aria-label="Header navigation" class="eevee-nav mdl-navigation" itemscope itemtype=http://schema.org/SiteNavigationElement><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons>  </i> Home </a><a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons></i> Blackhole </a><a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons></i> Eevee </a><a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons></i> Hauntr </a><a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons></i> Ghastly </a><a class="mdl-color-text--accent mdl-navigation__link" title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons></i> Pelican Plugins </a><a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons></i> Contact </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons></i> Archives </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons></i> RSS </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons></i> Atom </a></nav></div></div><div class="eevee-ribbon mdl-color--primary-dark" role=presentation></div><main class="eevee-main mdl-layout__content"><div class="eevee-container mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone" role=presentation></div><div aria-label="Main content" class="eevee-content mdl-color--white mdl-shadow--2dp mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=blackhole,blacklist,email,mail,postfix,spam itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-24T21:05:00+01:00 itemprop=datePublished> 24 Sep 2011 </time> — 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Postfix spam protection with blacklists'" href=https://kura.gg/2011/09/24/postfix-spam-protection-with-blacklists/ itemprop=url rel=bookmark> Postfix spam protection with blacklists </a></h2><section class=summary-content itemprop=articleBody><p>This really should be quite a quick and simple post.<p>I use several tools to protect my mail servers from spam, the most effective of these I’ve found is using external lists in conjunction with <strong>reject_rbl_client</strong> and <strong>reject_rhsbl_client</strong>.<p>+======================+======================================================================================================+ | Service | description | +======================+======================================================================================================+ | zen.spamhaus.org | A single lookup for querying the <span class=caps>SBL</span>, <span class=caps>XBL</span> and <span class=caps>PBL</span> databases. | | | - <span class=caps>SBL</span> - Verified sources of spam, including spammers and their support services | | | - <span class=caps>XBL</span> - Illegal third-party exploits (e.g. open proxies and Trojan Horses) | | | - <span class=caps>PBL</span> - Static, dial-up <span class=amp>&</span> <span class=caps>DHCP</span> <span class=caps>IP</span> address space that is not meant to be initiating <span class=caps>SMTP</span> connections | +———————————+———————————————————————————————————————————————————+ | dnsbl.sorbs.net | Unsolicited bulk/commercial email senders | +———————————+———————————————————————————————————————————————————+ | spam.dnsbl.sorbs.net | Hosts that have allegedly sent spam to the admins of <span class=caps>SORBS</span> at any time | +———————————+———————————————————————————————————————————————————+ | b1.spamcop.net | <span class=caps>IP</span> addresses which have been used to transmit reported email to SpamCop users | +———————————+———————————————————————————————————————————————————+ | rhsbl.ahbl.org | Domains sending spam, domains owned by spammers, comment spam domains, spammed URLs …</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=email,mail,postfix,pyzor,razor,spam,spamassassin itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-22T19:17:00+01:00 itemprop=datePublished> 22 Sep 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'SpamAssassin + Razor + Pyzor on Debian 6/Ubuntu'" href=https://kura.gg/2011/09/22/spamassassin-razor-pyzor/ itemprop=url rel=bookmark> SpamAssassin + Razor + Pyzor on Debian 6/Ubuntu </a></h2><section class=summary-content itemprop=articleBody><p>This is part 4 of my series on configuring a mail server, please see <a class="reference external" href=/2011/09/15/postfix-dovecot-imapimaps-sasl-maildir/>part one</a>, <a class="reference external" href=/2011/09/16/postfix-spamassassin-clamav-procmail/>part two</a> and <a class="reference external" href=/2011/09/17/postfix-dk-dkim-spf/>part three</a> if you’re not familiar with them.<p>The content of this article was written to work with the previous three articles but should work on any SpamAssassin set-up.<div class=section id=razor><h2>Razor</h2><p>First off we need to install Razor.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>razor
</pre></div><p>Now we need to run three commands to register and configure Razor.<div class=highlight><pre><span></span>sudo<span class=w> </span>razor-admin<span class=w> </span>-home<span class=o>=</span>/etc/spamassassin/.razor<span class=w> </span>-register
sudo<span class=w> </span>razor-admin<span class=w> </span>-home<span class=o>=</span>/etc/spamassassin/.razor<span class=w> </span>-create
sudo<span class=w> </span>razor-admin<span class=w> </span>-home<span class=o>=</span>/etc/spamassassin/.razor<span class=w> </span>-discover
</pre></div><p>These 3 commands should be pretty self explanatory, they register Razor, create it’s configuration and discover the Razor servers.</div><div class=section id=pyzor><h2>Pyzor</h2><p>Now we’ll install Pyzor.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>pyzor
</pre></div><p>Now we also need to tell Pyzor to discover it’s servers.<div class=highlight><pre><span></span>pyzor<span class=w> </span>--homedir<span class=w> </span>/etc/mail/spamassassin<span class=w> </span>discover
</pre></div></div><div class=section id=spamassassin><h2>SpamAssassin</h2><p>Add the following lines to the end …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apt,debian,security,ubuntu,upgrades itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-21T13:21:00+01:00 itemprop=datePublished> 21 Sep 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Debian/Ubuntu upgrade security packages only - a better way to do it'" href=https://kura.gg/2011/09/21/debianubuntu-upgrade-security-packages-only-a-better-way-to-do-it/ itemprop=url rel=bookmark> Debian/Ubuntu upgrade security packages only - a better way to do it </a></h2><section class=summary-content itemprop=articleBody><p><strong>I have created a scripts that handle these tasks for you, available `here`_.</strong><p>First thing we need to do is create an sources list specifically for security.<div class=highlight><pre><span></span>sudo<span class=w> </span>grep<span class=w> </span><span class=s2>"-security"</span><span class=w> </span>/etc/apt/sources.list<span class=w> </span><span class=p>|</span><span class=w> </span>sudo<span class=w> </span>grep<span class=w> </span>-v<span class=w> </span><span class=s2>"#"</span><span class=w> </span>><span class=w> </span>/etc/apt/security.sources.list
</pre></div><p>Now that this is done we can simply continue to use the command below to trigger security-only upgrades<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>upgrade<span class=w> </span>-o<span class=w> </span>Dir::Etc::SourceList<span class=o>=</span>/etc/apt/security.sources.list
</pre></div><div class=section id=note><h2>Note</h2><p><strong>This will work until you upgrade your distro (e.g. 10.04 -> 12.04), at which point you will need to re-run the first command to regenerate the security.sources.list file.</strong></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,dk,dkim,domainkeys,email,mail,postfix,spf,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-17T18:18:00+01:00 itemprop=datePublished> 17 Sep 2011 </time> — 3 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Postfix + DK (DomainKeys) + DKIM + SPF on Debian 6/Ubuntu'" href=https://kura.gg/2011/09/17/postfix-dk-dkim-spf/ itemprop=url rel=bookmark> Postfix + <span class=caps>DK</span> (DomainKeys) + <span class=caps>DKIM</span> + <span class=caps>SPF</span> on Debian 6/Ubuntu </a></h2><section class=summary-content itemprop=articleBody><p>This is part 3 of my guide to getting a mail server configured with all the sexy bits to improve deliverability, spam and virus protection.<p>You can view <a class="reference external" href=/2011/09/15/postfix-dovecot-imapimaps-sasl-maildir/>part 1 here</a> and <a class="reference external" href=/2011/09/16/postfix-spamassassin-clamav-procmail/>part 2 here</a>.<div class=section id=the-key-pair><h2>The key pair</h2><p>We need to create a key pair to sign emails with:<pre class=literal-block>
.. code-block:: bash
</pre><blockquote>openssl genrsa -out private.key 1024 openssl rsa -in private.key -out public.key -pubout -outform <span class=caps>PEM</span> sudo mkdir /etc/dk/ sudo cp private.key /etc/dk/dk.key</blockquote><p>Now we can move on to <span class=caps>DK</span> and <span class=caps>DKIM</span> signing, make sure you keep the public key for later.</div><div class=section id=dkim><h2><span class=caps>DKIM</span></h2><p>First we’ll need to install an application to sign our emails.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>dkim-filter
</pre></div><p>Once installed we need to configure it, open up <strong>/etc/default/dkim-filter</strong>, modify the file to look like below replacing <<span class=caps>DOMAIN</span>> with the domain you want to sign email from.<div class=highlight><pre><span></span><span class=nv>DAEMON_OPTS</span><span class=o>=</span><span class=s2>"-l -o X-DomainKeys …</span></pre></div></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=clamav,clamsmtp,debian,email,mail,postfix,procmail,spamassassin,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-16T21:28:00+01:00 itemprop=datePublished> 16 Sep 2011 </time> — 3 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Postfix + SpamAssassin + ClamAV + Procmail on Debian 6/Ubuntu'" href=https://kura.gg/2011/09/16/postfix-spamassassin-clamav-procmail/ itemprop=url rel=bookmark> Postfix + SpamAssassin + ClamAV + Procmail on Debian 6/Ubuntu </a></h2><section class=summary-content itemprop=articleBody><p>This is part 2 of my series on mail servers on Debian 6/Ubuntu 10.04, it should work on other versions of each though. <a class="reference external" href=/2011/09/15/postfix-dovecot-imapimaps-sasl-maildir/>Part 1 is available here</a>.<div class=section id=spamassassin><h2>SpamAssassin</h2><p>First off we’ll get SpamAssassin installed and configured.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>spamassassin
</pre></div><p>We’ll be configuring SpamAssassin as a daemon that Postfix interfaces with using <strong>spamc</strong>.<p>SpamAssassin on Debian and Ubuntu runs as root which is <span class=caps>NOT</span> a good thing so we’ll need to make some changes.<p>We’ll add a group called <strong>spamd</strong> with <span class=caps>GID</span>**5001**.<div class=highlight><pre><span></span>sudo<span class=w> </span>groupadd<span class=w> </span>-g<span class=w> </span><span class=m>5001</span><span class=w> </span>spamd
</pre></div><p>Next we add a user spamd with <span class=caps>UID</span> <strong>5001</strong> and add it to the spamd group, as well as set it’s home directory as <strong>/var/lib/spamassassin</strong> and make sure it has no shell access or <span class=caps>SSH</span> access.<div class=highlight><pre><span></span>sudo<span class=w> </span>useradd<span class=w> </span>-u<span class=w> </span><span class=m>5001</span><span class=w> </span>-g<span class=w> </span>spamd<span class=w> </span>-s<span class=w> </span>/usr/sbin/nologin<span class=w> </span>-d<span class=w> </span>/var/lib/spamassassin<span class=w> </span>spamd
</pre></div><p>Now …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,dovecot,email,imap,imaps,mail,maildir,postfix,sasl,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-15T23:04:00+01:00 itemprop=datePublished> 15 Sep 2011 </time> — 3 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Postfix + Dovecot (IMAP/IMAPS) + SASL + Maildir on Debian 6/Ubuntu'" href=https://kura.gg/2011/09/15/postfix-dovecot-imapimaps-sasl-maildir/ itemprop=url rel=bookmark> Postfix + Dovecot (<span class=caps>IMAP</span>/<span class=caps>IMAPS</span>) + <span class=caps>SASL</span> + Maildir on Debian 6/Ubuntu </a></h2><section class=summary-content itemprop=articleBody><p>This guide is part 1 of what I plan will be a couple of guides that take you through installing a base mail system, SpamAssassin, <span class=caps>DKIM</span> and much more. Stay tuned.<p>This guide was written for Debian 6 but should be the same or similar for Debian 5 and Ubuntu 10.04 and above.<div class=section id=the-installation><h2>The installation</h2><div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>dovecot-imapd<span class=w> </span>postfix<span class=w> </span>sasl2-bin<span class=w> </span>libsasl2-2<span class=w> </span>libsasl2-modules
</pre></div><p>Choose “Internet site” when prompted and enter the fully qualified name of your server.<p>Once all this is done installing we’ll need to make some changes, first off will be Postfix.</div><div class=section id=postfix><h2>Postfix</h2><p>Open up <strong>/etc/postfix/main.cf</strong> and add the following to the end of the file<pre class=literal-block>
home_mailbox = Maildir/
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $myhostname
broken_sasl_auth_clients = yes

smtpd_sender_restrictions = permit_sasl_authenticated,
    permit_mynetworks,

smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
    reject_unknown_sender_domain,
</pre><p>Here we basically tell Postfix to store all email in maildir format in the user’s home directory. We …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apt,apt-get,debian,headers,kernel,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-15T13:30:00+01:00 itemprop=datePublished> 15 Sep 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Installing kernel headers for current kernel version with ease on Debian/Ubuntu'" href=https://kura.gg/2011/09/15/installing-kernel-headers-for-current-kernel-version-with-ease-on-debianubuntu/ itemprop=url rel=bookmark> Installing kernel headers for current kernel version with ease on Debian/Ubuntu </a></h2><section class=summary-content itemprop=articleBody><p>This is a simple one but I found out that there are people out there that don’t know about it, so here we go.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>linux-headers-<span class=k>$(</span>uname<span class=w> </span>-r<span class=k>)</span>
</pre></div><p>This will install kernel headers for your current active kernel on Debian/Ubuntu.</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content="apache,load balancer,nginx,pound,reaip,x-forwarded-for" itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-08-10T12:34:00+01:00 itemprop=datePublished> 10 Aug 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'nginx log real IP from Pound'" href=https://kura.gg/2011/08/10/nginx-log-real-ip-from-pound/ itemprop=url rel=bookmark> nginx log real <span class=caps>IP</span> from Pound </a></h2><section class=summary-content itemprop=articleBody><p>Recently I started using Pound as a load balancer to a cluster of nginx servers and found my access logs were filled with the <span class=caps>IP</span> address of the load balancer. I did some digging and found the correct way to “fix” this.<p>First thing you need to do is make sure you remove X-Forwarded-For from Pound<pre class=literal-block>
ListenHTTP
    # ... snip ...
    # ... snip ...
    HeadRemove "X-Forwarded-For"
End
</pre><p>Once this is done, reload Pound.<p>Next you need nginx compiled with realip module - <a class="reference external" href=https://wiki.nginx.org/NginxHttpRealIpModule>https://wiki.nginx.org/NginxHttpRealIpModule</a><p>On Ubuntu/Debian servers this module comes by default, otherwise you may have to compile it in yourself using the following option:<div class=highlight><pre><span></span>--with-http_realip_module
</pre></div><p>Once this is all done modify your nginx vhosts and add the following 2 lines<div class=highlight><pre><span></span><span class=k>set_real_ip_from</span><span class=w> </span><span class=s>[IP]</span><span class=p>;</span>
<span class=k>real_ip_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=p>;</span>
</pre></div><p>Where [<span class=caps>IP</span>] is the <span class=caps>IP</span> address of your load balancer.<p>To configure this to work with Apache you need the mod_rpaf module.</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content="esx,iscsi,scsi,shared vmdk,vmdk,vmware" itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-07-09T02:07:00+01:00 itemprop=datePublished> 09 Jul 2011 </time> — 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Shared VMDKs on ESX vSphere'" href=https://kura.gg/2011/07/09/shared-vmdks-on-esx-vsphere/ itemprop=url rel=bookmark> Shared VMDKs on <span class=caps>ESX</span> vSphere </a></h2><section class=summary-content itemprop=articleBody><p>I’d first like to point out that although the VMDKs are shared between hosts using a shared <span class=caps>SCSI</span> <span class=caps>BUS</span> they are not synched, meaning that if you write to the mounted point on any machine it will not display on other machines with the same mount point until you remount the drive. Annoying, but understandable.<p>To business.<p>First off all machines that you want to share this <span class=caps>VMDK</span> with will need to be <span class=caps>OFFLINE</span>.<p>Next up we create the <span class=caps>VMDK</span>, I find it easiest to do this by adding hardware to an already existing machine, I’m going to use one that I want the <span class=caps>VMDK</span> shared with to make it even simpler.</p><img alt="Create a new disk" src=/images/shared-vmdks-on-esx-vsphere1.png><p>You will need to enable clustering features as shown below, this means you cannot use thin provisioning.</p><img alt="Choose disk size" src=/images/shared-vmdks-on-esx-vsphere2.png><p>You will need to add the <span class=caps>VMDK</span> to a new <span class=caps>SCSI</span> <span class=caps>BUS</span>, this will usually begin with 1: or …</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content="google analytics,logging,nginx" itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-06-05T20:41:00+01:00 itemprop=datePublished> 05 Jun 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Logging Google Analytics cookies with nginx'" href=https://kura.gg/2011/06/05/logging-google-analytics-cookies-with-nginx/ itemprop=url rel=bookmark> Logging Google Analytics cookies with nginx </a></h2><section class=summary-content itemprop=articleBody><p>I was recently tasked with adding Google tracking cookies to our nginx logging for a couple of sites. It was so it could be pushed through a log processor.<p>It turned out too be a little trickier than it would have been with Apache, but the process itself is still quite simple.<p>Open up the server definition you wish to add it to and add a custom log format like below<pre class=literal-block>
log_format g-a '$remote_addr - $remote_user [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent" ' '"__utma=$cookie___utma;__utmb=$cookie___utmb;__utmc=$cookie___utmc;__utmv=$cookie___utmv;__utmz=$cookie_umtz"';
</pre><p>This log format can then be added to your access log like below:<div class=highlight><pre><span></span><span class=k>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.example.com.log</span><span class=w> </span><span class=s>g-a</span><span class=p>;</span>
</pre></div><p>Reload nginx<div class=highlight><pre><span></span>sudo<span class=w> </span>/etc/init.d/nginx<span class=w> </span>reload
</pre></div><p>If all goes well, you should see Google Analytics appearing in your access logs like below<pre class=literal-block>
1.1.1.1 - - [05/Jun/2011:20:35:50 +0100] "GET / HTTP …</pre></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=ssh,tunnel itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-02-14T20:37:00+00:00 itemprop=datePublished> 14 Feb 2011 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'SSH Tunnelling'" href=https://kura.gg/2011/02/14/ssh-tunnelling/ itemprop=url rel=bookmark> <span class=caps>SSH</span> Tunnelling </a></h2><section class=summary-content itemprop=articleBody><p>Quite a simple one:<div class=highlight><pre><span></span>ssh<span class=w> </span>-f<span class=w> </span>USER@INTERMEDIATE_DEVICE<span class=w> </span>-L<span class=w> </span>LOCAL_PORT:DESTINATION_DEVICE:DESTINATION_PORT<span class=w> </span>-N
</pre></div><p><strong>-f</strong> tells ssh to go to background <strong>-L</strong> binds a local port to a remote device and port <strong>-N</strong> tells ssh not to execute any commands<p>So use this to tunnel from local port 8000 in to a remote machine on port 22 you’d use<div class=highlight><pre><span></span>ssh<span class=w> </span>-f<span class=w> </span>user@server.test.com<span class=w> </span>-L<span class=w> </span><span class=m>8000</span>:server.destination.com:22<span class=w> </span>-N
</pre></div><p>Once the tunnel is open you can use the following to ssh or scp data around<div class=highlight><pre><span></span>ssh<span class=w> </span>localhost<span class=w> </span>-p<span class=w> </span><span class=m>8000</span>
scp<span class=w> </span>-P<span class=w> </span><span class=m>8000</span><span class=w> </span>/path/to/local/file<span class=w> </span>user@localhost:~
scp<span class=w> </span>-P<span class=w> </span><span class=m>8000</span><span class=w> </span>user@localhost:/path/to/remote/file<span class=w> </span>.
</pre></div><p>I use ssh tunnels all the time to remote access and use one of our Solr servers that is blocked behind a firewall.</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apt-get,aptitude,security,update,upgrade itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-12-13T16:27:00+00:00 itemprop=datePublished> 13 Dec 2010 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Debian/Ubuntu upgrade security packages only'" href=https://kura.gg/2010/12/13/debianubuntu-upgrade-security-packages-only/ itemprop=url rel=bookmark> Debian/Ubuntu upgrade security packages only </a></h2><section class=summary-content itemprop=articleBody><p><strong>The command below no longer works, for an updated version that does work and should continue to work (until you upgrade to a new distro version e.g. 10.04 -> 12.04) please see `here`_.</strong><p>Really simple, should work for most cases, I’ve not found anything wrong with it.<div class=highlight><pre><span></span>sudo<span class=w> </span>aptitude<span class=w> </span>update<span class=w> </span><span class=o>&&</span><span class=w> </span>sudo<span class=w> </span>aptitude<span class=w> </span>install<span class=w> </span><span class=s1>'?and(~U,~Asecurity)'</span>
</pre></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=linux,online,partition itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-10-20T17:17:00+01:00 itemprop=datePublished> 20 Oct 2010 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Refresh Linux partition table online'" href=https://kura.gg/2010/10/20/refresh-linux-partition-table-online/ itemprop=url rel=bookmark> Refresh Linux partition table online </a></h2><section class=summary-content itemprop=articleBody><div class=section id=if-the-device-is-not-mounted><h2>If the device is not mounted</h2><div class=highlight><pre><span></span>sudo<span class=w> </span>blockdev<span class=w> </span>--rereadpt<span class=w> </span>DEVICE
</pre></div><p>E.g.<div class=highlight><pre><span></span>sudo<span class=w> </span>blockdev<span class=w> </span>--rereadpt<span class=w> </span>/dev/sda
</pre></div></div><div class=section id=if-the-device-is-mounted><h2>If the device is mounted</h2><p>Parted is awesome and does this job amazingly.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>parted
sudo<span class=w> </span>partprobe
</pre></div></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apache,nginx,varnish,wordpress itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-09-26T19:41:00+01:00 itemprop=datePublished> 26 Sep 2010 </time> — 6 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'WordPress + nginx + Varnish + Apache 2'" href=https://kura.gg/2010/09/26/nginx-varnish-apache2/ itemprop=url rel=bookmark> WordPress + nginx + Varnish + Apache 2 </a></h2><section class=summary-content itemprop=articleBody><p>Lately I’ve been doing a lot of work with Varnish, this includes testing it within a load balanced environment, putting it behind nginx, putting it in front of Solr, the list goes on.<p>This blog post will hopefully give you an insight in to a simple way of combining nginx, Varnish and Apache to create a powerful Wordpress environment that can really take a hammering.<p>I’m going to assume you already have Apache and nginx working together, if not I suggest you read my other articles on these subjects to learn how to combine them.<div class=section id=installing-varnish><h2>Installing Varnish</h2><div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>varnish
</pre></div></div><div class=section id=configuring-apache><h2>Configuring Apache</h2><p>I suggest binding Apache to port 81, this is easy to change, open the following file in your favourite editor.<blockquote>/etc/apache2/ports.conf</blockquote><p>Change the Listen and NameVirtualHost lines to:<div class=highlight><pre><span></span><span class=nb>Listen</span><span class=w> </span><span class=m>81</span>
<span class=nb>NameVirtualHost</span><span class=w> </span>*:81
</pre></div><p>This will mean you need to go and change all …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=ssh,sshfs itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-09-26T01:55:00+01:00 itemprop=datePublished> 26 Sep 2010 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Mounting a remote filesystem using sshfs'" href=https://kura.gg/2010/09/26/mounting-a-remote-filesystem-using-sshfs/ itemprop=url rel=bookmark> Mounting a remote filesystem using sshfs </a></h2><section class=summary-content itemprop=articleBody><p>First we need to install sshfs.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>sshfs<span class=w> </span>fuse-utils
</pre></div><p>Now we make a mount point, I’m going to use a directory in my home directory for this.<div class=highlight><pre><span></span>mkd﻿ir<span class=w> </span>~/remote-content
</pre></div><p>And now we simply mount our remote directory to it.<div class=highlight><pre><span></span>sshfs<span class=w> </span>user@host:/path/to/location<span class=w> </span>~/remote-content
</pre></div><p>It’s as simple as that.</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=mysql,replication itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-09-04T18:14:00+01:00 itemprop=datePublished> 04 Sep 2010 </time> — 3 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'MySQL Master-Master-Slave-Slave Replication'" href=https://kura.gg/2010/09/04/mysql-master-master-slave-slave-replication/ itemprop=url rel=bookmark> MySQL Master-Master-Slave-Slave Replication </a></h2><section class=summary-content itemprop=articleBody><div class=section id=quick-introduction><h2>Quick introduction</h2><p>My employers presented me with a challenge this week. The task was not difficult in the end but to me it was an untried concept involving MySQL.<p>I have never been a fan of MySQL and generally turn my nose at the thought of using it, let alone replicating it etc.<p>The task in question? Master -> Master -> Slave -> Slave replication.<p>From this point forward I will expect you to have MySQL installed and set-up as normal.<ul class=simple><li>Master 1 will be known as Master 1 and Slave 2 with <span class=caps>IP</span> 10.1.1.1<li>Master 2 will be known as Master 2 and Slave 1 with <span class=caps>IP</span> 10.1.1.2<li>Slave 1 will be known as Slave 3 with <span class=caps>IP</span> 10.1.1.3<li>and Slave 2 will be known as Slave 4 with <span class=caps>IP</span> 10.1.1.4</ul></div><div class=section id=master-1><h2>Master 1</h2><p>Modify your MySQL config file, usually named …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=find,sed,xargs itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-08-13T19:19:00+01:00 itemprop=datePublished> 13 Aug 2010 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Find and replace across multiple files'" href=https://kura.gg/2010/08/13/find-and-replace-across-multiple-files/ itemprop=url rel=bookmark> Find and replace across multiple files </a></h2><section class=summary-content itemprop=articleBody><p>I needed to quickly modify 500 hundred <span class=caps>XML</span> files, each was about <span class=caps>10MB</span> in size, thankfully Linux makes that pretty fast and very easy.<div class=highlight><pre><span></span>find<span class=w> </span>.<span class=w> </span>-name<span class=w> </span><span class=s2>"*.xml"</span><span class=w> </span>-print<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>'s/FROM/TO/g'</span>
</pre></div><p>A semi “real world” example:<div class=highlight><pre><span></span>find<span class=w> </span>.<span class=w> </span>-name<span class=w> </span><span class=s2>"*.xml"</span><span class=w> </span>-print<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>'s/foo/bar/g'</span>
</pre></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,swap,vmware itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-07-07T18:56:00+01:00 itemprop=datePublished> 07 Jul 2010 </time> — 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Adding swap while the server is online with Debian and VMWare ESX'" href=https://kura.gg/2010/07/07/adding-swap-while-the-server-is-online-with-debian-and-vmware-esx/ itemprop=url rel=bookmark> Adding swap while the server is online with Debian and VMWare <span class=caps>ESX</span> </a></h2><section class=summary-content itemprop=articleBody><p>Recently I had to install Oracle on a virtual machine but didn’t find out until after I’d spun up of the machine that Oracle required at least <span class=caps>2GB</span> of swap space, my machine did not have enough.<p>Thankfully it’s quite simple to increase swap space, using VMWare <span class=caps>ESX</span>, simple add a new drive to the machine as you normally would, I used <span class=caps>5GB</span>.<div class=section id=detecting-the-new-scsi-drive-and-partitioning-it><h2>Detecting the new <span class=caps>SCSI</span> drive and partitioning it</h2><p>This bit is simple, I’m going to assume you’re logged in as root.<div class=highlight><pre><span></span>sudo<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>"- - -"</span><span class=w> </span>><span class=w> </span>/sys/class/scsi_host/**host0**/scan<span class=w> </span><span class=o>&&</span><span class=w> </span>fdisk<span class=w> </span>-l
</pre></div><p>If host0 doesn’t work, try changing to host1, host2 etc.<p>Now we need to format the drive, for me it was /dev/sdb.<div class=highlight><pre><span></span>sudo<span class=w> </span>cfdisk<span class=w> </span>/dev/sdb
</pre></div><p>Create a new logical partition, set it’s type to <strong>82 Linux Swap</strong> and simply write the changes.</div><div class=section id=adding-swap><h2>Adding swap</h2><p>Next we simply add …</div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=incron,infobright,inotify,mysql itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-07-03T15:26:00+01:00 itemprop=datePublished> 03 Jul 2010 </time> — 3 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Trigger command on filesystem changes with inotify + incron'" href=https://kura.gg/2010/07/03/trigger-command-on-filesystem-changes-with-inotify-incron/ itemprop=url rel=bookmark> Trigger command on filesystem changes with inotify + incron </a></h2><section class=summary-content itemprop=articleBody><p>During a seemingly normal work day a colleague pointed out a problem to me and asked if I had any solution.<p>The problem was that they were trying to use InfoBright (<a class="reference external" href=https://www.infobright.com/>https://www.infobright.com/</a>) for some data crunching, export the data to <span class=caps>CSV</span> and then import in to MySQL. My first idea was to output the data from InfoBright as <span class=caps>SQL</span> and pipe it directly in to MySQL, this turned out to not be possible as the version of <span class=caps>IB</span> they were using only supported output as <span class=caps>CSV</span>.<p>This in itself wasn’t a problem, the problem lay with the fact that <span class=caps>IB</span> would only output the file with 0660 permissions, and although both <span class=caps>IB</span> and MySQL ran as user mysql and group mysql, MySQL itself flat out refused to import the <span class=caps>CSV</span> file unless it was world readable (0664), which was slightly annoying.<p>If the <span class=caps>CSV</span> didn’t …</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apt,backup,dpkg,packages itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-07-02T18:32:00+01:00 itemprop=datePublished> 02 Jul 2010 </time> — 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Using dpkg selections to backup and install packages'" href=https://kura.gg/2010/07/02/using-dpkg-selections-to-backup-and-install-packages/ itemprop=url rel=bookmark> Using dpkg selections to backup and install packages </a></h2><section class=summary-content itemprop=articleBody><p>Sometimes you want to be able to install packages on another machine without the hassle of a long apt-get install command or having to write down every single package you’ve installed.<p>Luckily Debian has the wonderful dpkg which has 2 methods for generating a list of installed packages and another for importing a list.<div class=section id=generating-a-list-of-installed-packages><h2>Generating a list of installed packages</h2><div class=highlight><pre><span></span>sudo<span class=w> </span>dpkg<span class=w> </span>--get-selections<span class=w> </span>><span class=w> </span>selections
</pre></div><p>This will generate a file called <em>selections</em> which will contain something like<pre class=literal-block>
... snip ...
adduser install
apache2 install
apache2-mpm-prefork install
apache2-utils install
apache2.2-bin install
apache2.2-common install
apt install
... snip...
</pre><p>This is just a simple, plain text file so can be copied between servers.</div><div class=section id=installing-packages-from-an-exported-list><h2>Installing packages from an exported list</h2><p>This is almost just as easy, first we need to actually set the list of selected packages<div class=highlight><pre><span></span>sudo<span class=w> </span>dpkg<span class=w> </span>--set-selections<span class=w> </span><<span class=w> </span>selections
</pre></div><p>Then we need to actually do an update and install<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&&</span><span class=w> </span>sudo …</pre></div></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=apache,cache,nginx,proxy,proxy_cache,wordpress itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-04-18T12:51:00+01:00 itemprop=datePublished> 18 Apr 2010 </time> — 4 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'New syslog.tv nginx wordpress site configuration explained'" href=https://kura.gg/2010/04/18/new-syslog-tv-nginx-wordpress-site-configuration/ itemprop=url rel=bookmark> New syslog.tv nginx wordpress site configuration explained </a></h2><section class=summary-content itemprop=articleBody><div class=section id=configuration-changes><h2>Configuration changes</h2><p>I made some modifications to my nginx configuration this weekend to improve performance and clear up some bugs.<div class=highlight><pre><span></span><span class=k>upstream</span><span class=w> </span><span class=s>backend</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>81</span><span class=w> </span><span class=s>fail_timeout=120s</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>syslog.tv</span><span class=p>;</span>

<span class=w>    </span><span class=kn>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.syslog.tv.log</span><span class=p>;</span>

<span class=w>    </span><span class=kn>gzip</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>gzip_disable</span><span class=w> </span><span class=s>msie6</span><span class=p>;</span>
<span class=w>    </span><span class=kn>gzip_static</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>gzip_comp_level</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>
<span class=w>    </span><span class=kn>gzip_proxied</span><span class=w> </span><span class=s>any</span><span class=p>;</span>
<span class=w>    </span><span class=kn>gzip_types</span><span class=w> </span><span class=s>text/plain</span><span class=w> </span><span class=s>text/css</span><span class=w> </span><span class=s>application/x-javascript</span><span class=w> </span><span class=s>text/xml</span>
<span class=w>    </span><span class=s>application/xml</span><span class=w> </span><span class=s>application/xml+rss</span><span class=w> </span><span class=s>text/javascript</span><span class=p>;</span>

<span class=w>   </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/var/www/syslog.tv</span><span class=p>;</span>

<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$wordpress_logged_in</span><span class=w> </span><span class=s>""</span><span class=p>;</span>
<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author_email</span><span class=w> </span><span class=s>""</span><span class=p>;</span>
<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author</span><span class=w> </span><span class=s>""</span><span class=p>;</span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"wordpress_logged_in_[^=]*=([^%]+)%7C")</span><span class=w> </span><span class=p>{</span>
<span class=w>             </span><span class=kn>set</span><span class=w> </span><span class=nv>$wordpress_logged_in</span><span class=w> </span><span class=s>wordpress_logged_in_</span><span class=nv>$1</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"comment_author_email_[^=]*=([^</span><span class=p>;</span><span class=kn>]+)(</span><span class=p>;</span><span class=kn>|$)")</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author_email</span><span class=w> </span><span class=s>comment_author_email_</span><span class=nv>$1</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$http_cookie</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>"comment_author_[^=]*=([^</span><span class=p>;</span><span class=kn>]+)(</span><span class=p>;</span><span class=kn>|$)")</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=kn>set</span><span class=w> </span><span class=nv>$comment_author</span><span class=w> </span><span class=s>comment_author_</span><span class=nv>$1</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$my_cache_key</span><span class=w> </span><span class=s>"</span><span class=nv>$scheme://$host$uri$is_args$args$wordpress_logged_in$comment_author_email$comment_author"</span><span class=p>;</span>

<span class=w>        </span><span class=kn>client_max_body_size</span><span class=w> </span><span class=mi>8m</span><span class=p>;</span>

<span class=w>        </span><span class=kn>proxy_redirect</span><span class=w> </span><span class=no>off</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_pass_header</span><span class=w> </span><span class=s>Set-Cookie</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_cache</span><span class=w> </span><span class=s>cache</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_cache_key</span><span class=w> </span><span class=nv>$my_cache_key</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_cache_valid</span><span class=w> </span><span class=mi>200</span><span class=w> </span><span class=mi>302</span><span class=w> </span><span class=mi>60m</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_cache_valid</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=mi>1m</span><span class=p>;</span>
<span class=w>        </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>https://backend</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>.(jpg|png|gif|jpeg|js|css …</span></pre></div></div></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=crt,openssl,pem,pkcs12,ssl itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-04-13T19:19:00+01:00 itemprop=datePublished> 13 Apr 2010 </time> — < 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Convert PEM & Key to a single PKCS#12 file'" href=https://kura.gg/2010/04/13/convert-pem-key-to-a-single-pkcs12-file/ itemprop=url rel=bookmark> Convert <span class=caps>PEM</span> <span class=amp>&</span> Key to a single <span class=caps>PKCS</span>#12 file </a></h2><section class=summary-content itemprop=articleBody><p>Sometimes keeping multiple copies of keys, certificates and root certificates can be a real annoyance, thankfully it’s quite simple to convert them in to a single <span class=caps>PKCS</span>#12 file with the following command.<div class=highlight><pre><span></span>openssl<span class=w> </span>pkcs12<span class=w> </span>-export<span class=w> </span>-out<span class=w> </span>certificate.pkcs<span class=w> </span>-in<span class=w> </span>certificate.crt<span class=w> </span>-inkey<span class=w> </span>private.key<span class=w> </span>-certfile<span class=w> </span>rootcert.crt<span class=w> </span>-name<span class=w> </span><span class=s2>"PKCS#12 Certificate Bundle"</span>
</pre></div><p>This will create a file called <strong>certificate.pkcs</strong> which will contain the contents of the <strong>certificate.crt</strong>, <strong>private.key</strong> and your root certificate <strong>rootcert.crt</strong>, it will also have an internal reference to it’s name <strong><span class=caps>PKCS</span>#12 Certificate Bundle</strong> to make it easier to inspect the certificate to find what it should contain, usually you’d set this to something more useful.</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,fedora,install,nginx,redhat,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-04-02T16:54:00+01:00 itemprop=datePublished> 02 Apr 2010 </time> — 4 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Building nginx on Red Hat and Debian to RPM/DEB-style locations'" href=https://kura.gg/2010/04/02/building-nginx-on-red-hat-and-debian-to-rpmdeb-style-locations/ itemprop=url rel=bookmark> Building nginx on Red Hat and Debian to <span class=caps>RPM</span>/<span class=caps>DEB</span>-style locations </a></h2><section class=summary-content itemprop=articleBody><p>The title of this post is a bit stupid, but I honestly couldn’t think of any other way to write it…<p>When compiling nginx by hand, by default make install will push the binaries out to /usr/local/nginx and it doesn’t come with a start/stop script, understandably because it doesn’t know which <span class=caps>OS</span> it is going to be installed on etc etc.<p>Recently I was tasked with building nginx to an old Red Hat Enterprise Live 4 server with no yum installation, no nginx package in up2date and not being able to find an <span class=caps>RPM</span> that’s link wasn’t dead.<p>I’ve always felt that, being a Debian user, people think of me as only being able to use apt-get and if I’m feeling especially adventurous dpkg - to install applications. Some people know that I build .deb files in my spare time, but …</section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content="apache,load average" itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-03-27T19:29:00+00:00 itemprop=datePublished> 27 Mar 2010 </time> — 2 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Apache internal dummy connection'" href=https://kura.gg/2010/03/27/apache-internal-dummy-connection/ itemprop=url rel=bookmark> Apache internal dummy connection </a></h2><section class=summary-content itemprop=articleBody><p>Recently I found that one of the servers I look after that runs a high profile site was generating semi-high load at traffic peaks. You could generally say that this would be understandable but the server was shooting up to a load of around 10 for a few seconds and with that load jump I was able to graph an increase of Apache processes on top of it. Again though, this would generally be considered normal, but knowing how well the server performs and having nginx sitting on top handling all static content I knew something wasn’t quite right.<p>Looking through the logs I found quite a lot of requests from a badly written spider which was generating a lot of server load when it hit the server, but after <span class=caps>IP</span> banning the culprit I also found several instances of Apache waking it’s child processes.<pre class=literal-block>
127.0.0 …</pre></section><div class="eevee-divider mdl-color--accent" role=presentation></div><div class=eevee-divider-to-top><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></div></article><article class=eevee-padding itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,monitoring,nagios,nrpe,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2010-03-21T21:55:00+00:00 itemprop=datePublished> 21 Mar 2010 </time> — 1 min read</div><h2 class=article-title itemprop=name><a title="Permalink to 'Configuring Nagios to monitor remote load, disk, swap etc using NRPE'" href=https://kura.gg/2010/03/21/configuring-nagios-to-monitor-remote-load-disk-using-nrpe/ itemprop=url rel=bookmark> Configuring Nagios to monitor remote load, disk, swap etc using <span class=caps>NRPE</span> </a></h2><section class=summary-content itemprop=articleBody><p>I’ll assume you already have Nagios installed and configured and have an understanding of actually configuring and using Nagios.<div class=section id=remote-server-the-server-to-be-monitored><h2>Remote server — the server to be monitored</h2><p>First we’ll install the needed plugins and daemon on the <strong>remote</strong> server.<div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>nagios-plugins<span class=w> </span>nagios-nrpe-server
</pre></div><p>Once installed, open up <strong>/etc/nagios/nrpe_local.cfg</strong><p>And place the following in it<pre class=literal-block>
allowed_hosts=NAGIOS.SERVER.IP,127.0.0.1

command[check_users]=/usr/lib/nagios/plugins/check_users -w 5 -c 10
command[check_load]=/usr/lib/nagios/plugins/check_load -w 15,10,5 -c 30,25,20
command[check_all_disks]=/usr/lib/nagios/plugins/check_disk -w 20 -c 10
command[check_zombie_procs]=/usr/lib/nagios/plugins/check_procs -w 5 -c 10 -s Z
command[check_total_procs]=/usr/lib/nagios/plugins/check_procs -w 150 -c 200
command[check_swap]=/usr/lib/nagios/plugins/check_swap -w 20 -c 10
</pre><p>Save and exit.<p>Commands need to explicitly be enabled on the …</div></section></article><div class=eevee-page-spacer role=presentation></div></div></div></main><div class="eevee-pagination__container eevee-container mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone" role=presentation></div><div class="mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><nav class="eevee-pagination mdl-cell mdl-cell--12-col" aria-label=Pagination itemscope itemtype=http://schema.org/SiteNavigationElement><a class=eevee-nav__button href=https://kura.gg/page/3/ itemprop=url rel=bookmark title=Newer> <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation><i class=material-icons></i></button> Newer </a><div class=eevee-spacer></div><a class=eevee-nav__button href=https://kura.gg/page/5/ itemprop=url rel=bookmark title=Older> Older <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation><i class=material-icons></i></button> </a></nav></div></div><footer class=mdl-mega-footer itemscope itemtype=http://schema.org/SiteNavigationElement><div class=mdl-mega-footer--top-section><div class=mdl-mega-footer--drop-down-section><ul class=mdl-mega-footer--link-list><li><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></ul></div></div><div aria-label="Footer navigation" class=mdl-mega-footer--middle-section itemscope itemtype=http://schema.org/SiteNavigationElement><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Menu</h1><ul class=mdl-mega-footer--link-list><li><a href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons></i> Contact </a><li><a href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons></i> Archives </a><li><a href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons></i> RSS </a><li><a href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons></i> Atom </a></ul></div><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Social</h1><ul class=mdl-mega-footer--link-list><li><a href=https://github.com/kura itemprop=url rel=bookmark title=GitHub> <i aria-hidden=true class=fa></i> Github </a><li><a href=https://noc.social/@kura itemprop=url rel=me title=@kura@noc.social> <i aria-hidden=true class=fa>🦣</i> @kura@noc.social </a></ul></div><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Links</h1><ul class=mdl-mega-footer--link-list><li><a href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons></i> Blackhole </a><li><a href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons></i> Eevee </a><li><a href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons></i> Hauntr </a><li><a href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons></i> Ghastly </a><li><a title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons></i> Pelican Plugins </a></ul></div></div><div class=mdl-mega-footer--bottom-section><div class=mdl-logo><a href=https://kura.gg itemprop=url rel=bookmark title=kura.gg> kura.gg </a></div><ul class="eevee-footer mdl-mega-footer--link-list"><li>Powered by love & rainbow sparkles.<li>Source code and content released under the <a title="MIT license" href=/license/>MIT license</a>.</ul></div></footer></div>