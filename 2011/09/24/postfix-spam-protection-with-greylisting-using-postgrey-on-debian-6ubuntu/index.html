<!doctype html><html lang=en><meta charset=utf-8><meta content=width=device-width,initial-scale=1.0,minimum-scale=1.0 name=viewport><link href=https://kura.gg hreflang=en rel=alternate><link href=https://kura.gg rel=dns-prefetch><link href=https://kura.gg/theme/css/eevee.min.css?1c9d8344 rel=stylesheet><script async src=https://kura.gg/theme/js/eevee.min.js?1841d254></script><link href=https://kura.gg/feeds/rss.xml rel=alternate title=kura.gg type=application/rss+xml><link href=https://kura.gg/feeds/atom.xml rel=alternate title=kura.gg type=application/atom+xml><meta content=kura.gg property=og:site_name><meta content=article property=og:type><meta content="Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu" property=og:title><meta content=https://kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/ property=og:url><meta content="A simple yet effective method for protecting your mail server from spam is to use greylisting. In simple terms, when an email is received the server will temporarily reject it with a 450 response code claiming that the server is busy, the sending server should then attempt to try to deliver at a later point in time, if enough time has passed the recipient server will then accept the incoming mail and whitelist the send address for a period of time. This is effective because most spam servers are configured not to retry the send whereas real mail servers generally will retry. This sadly does not protect against spam coming from comprised mail servers or accounts like on Hotmail.com. Installation sudo apt-get install postgrey Configuring Postgrey By default Postgrey runs on 127.0.0.1:60000, which is the local loopback interface so it is not exposed to the â€¦" property=og:description><meta content=https://kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/index.png property=og:image><meta content=1920 property=og:image:width><meta content=1080 property=og:image:height><meta content="Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu" property=twitter:title><meta content=https://kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/ property=twitter:url><meta content="A simple yet effective method for protecting your mail server from spam is to use greylisting. In simple terms, when an email is received the server will temporarily reject it with a 450 response code claiming that the server is busy, the sending server should then attempt to try to deliver at a later point in time, if enough time has passed the recipient server will then accept the incoming mail and whitelist the send address for a period of time. This is effective because most spam servers are configured not to retry the send whereas real mail servers generally will retry. This sadly does not protect against spam coming from comprised mail servers or accounts like on Hotmail.com. Installation sudo apt-get install postgrey Configuring Postgrey By default Postgrey runs on 127.0.0.1:60000, which is the local loopback interface so it is not exposed to the â€¦" property=twitter:description><meta content=https://kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/index.png property=twitter:image><meta content=summary_large_image property=twitter:card><meta content="Written by" property=twitter:label1><meta content=Kura property=twitter:data1><meta content="Estimated reading time" property=twitter:label2><meta content="2 min read" property=twitter:data2><meta content=1920 property=twitter:image:width><meta content=1080 property=twitter:image:height><link sizes="16x16 32x32 48x48 64x64 128x128 256x256" href=/favicon.png rel=icon type=image/png><link sizes="16x16 32x32 48x48 64x64 128x128 256x256" href=/favicon.ico rel=icon type=image/vnd.microsoft.icon><title>Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu</title><body><div class="eevee-layout mdl-layout mdl-js-layout mdl-color--grey-50"><header class="eevee-header mdl-color--grey-50 mdl-color-text--grey-800" itemscope itemtype=http://schema.org/WPHeader><div class=mdl-layout__header-row><div class="mdl-layout__drawer-button mdl-color-text--accent eevee-mobile-button mdl-layout--small-screen-only" aria-expanded=false role=button tabindex=0><i class=material-icons>î—’</i></div><span class="eevee-logo mdl-color-text--accent mdl-layout-title"> <h2 id=top><a href=https://kura.gg rel=bookmark title=kura.gg> kura.gg </a></h2> </span><div class=mdl-layout-spacer role=presentation></div><nav aria-label="Header navigation" class="eevee-nav mdl-navigation mdl-layout--large-screen-only" itemscope itemtype=http://schema.org/SiteNavigationElement><a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons>î¡¯</i> Blackhole </a><a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons>î¡±</i> Eevee </a><a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons>î¡±</i> Hauntr </a><a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons>î¡±</i> Ghastly </a><a class="mdl-color-text--accent mdl-navigation__link" title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons>î¡¯</i> Pelican Plugins </a><a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons>î‚·</i> Contact </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>î€¯</i> Archives </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons>îƒ¥</i> RSS </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons>îƒ¥</i> Atom </a></nav></div></header><div class="eevee-mobile-header mdl-layout__drawer mdl-color--white" aria-hidden=true><span class=mdl-layout-title> <h2 class="eevee-mobile-logo mdl-color-text--accent">kura.gg</h2> </span><div class="mdl-navigation mdl-color--white"><nav aria-label="Header navigation" class="eevee-nav mdl-navigation" itemscope itemtype=http://schema.org/SiteNavigationElement><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons> î¢Š </i> Home </a><a class="mdl-color-text--accent mdl-navigation__link" href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons>î¡¯</i> Blackhole </a><a class="mdl-color-text--accent mdl-navigation__link" href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons>î¡±</i> Eevee </a><a class="mdl-color-text--accent mdl-navigation__link" href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons>î¡±</i> Hauntr </a><a class="mdl-color-text--accent mdl-navigation__link" href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons>î¡±</i> Ghastly </a><a class="mdl-color-text--accent mdl-navigation__link" title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons>î¡¯</i> Pelican Plugins </a><a class="mdl-color-text--accent mdl-navigation__link" href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons>î‚·</i> Contact </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>î€¯</i> Archives </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons>îƒ¥</i> RSS </a><a class="mdl-color-text--accent mdl-navigation__link" href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons>îƒ¥</i> Atom </a></nav></div></div><div class="eevee-ribbon mdl-color--primary-dark" role=presentation></div><main class="eevee-main mdl-layout__content"><div class="eevee-container mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone" role=presentation></div><div aria-label="Main content" class="eevee-content mdl-color--white mdl-shadow--2dp mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><article itemscope itemtype=http://schema.org/BlogPosting><meta content=fullKeyboardControl itemprop=accessibilityControl><meta content=fullMouseControl itemprop=accessibilityControl><meta content=bookmarks itemprop=accessibilityControl><meta content=captions itemprop=accessibilityControl><meta content=alternativeText itemprop=accessibilityControl><meta content=index itemprop=accessibilityControl><meta content=readingOrder itemprop=accessibilityControl><meta content=structuralNavigation itemprop=accessibilityControl><meta content=tableOfContents itemprop=accessibilityControl><meta content=noFlashingHazard itemprop=accessibilityHazard><meta content=noMotionSimulationHazard itemprop=accessibilityHazard><meta content=noSoundHazard itemprop=accessibilityHazard><meta content=ARIA itemprop=accessibilityAPI><div itemprop=author itemscope itemtype=https://schema.org/Person role=presentation><a class=hidden href=https://kura.gg/authors/kura/ itemprop=url role=presentation> <span class=hidden itemprop=name role=presentation> kura </span> </a></div><meta content=debian,email,greylist,mail,postfix,postgrey,spam,ubuntu itemprop=keywords><meta content=tutorials itemprop=keywords><div class=eevee-share><ul class="social-share mdl-navigation"><li class="social-share__link social-share__link--twitter"><a onclick="window.open(this.href, 'twitter-share', 'width=550,height=235'); return false;" title="Share 'Postfix spam protection with greylisting using Postgrey on Debian 6/Ubuntu' on Twitter" href=https://twitter.com/intent/tweet?text=Postfix%20spam%20protection%20with%20greylisting%20using%20Postgrey%20on%20Debian%206/Ubuntu&url=https%3A//kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/> <i aria-hidden=true class=fa>ï‚™</i> </a><li class="social-share__link social-share__link--facebook"><a onclick="window.open(this.href, 'facebook-share', 'width=580,height=296'); return false;" title="Share 'Postfix spam protection with greylisting using Postgrey on Debian 6/Ubuntu' on Facebook" href=https://www.facebook.com/sharer/sharer.php?u=https%3A//kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/> <i aria-hidden=true class=fa>ï‚š</i> </a><li class="social-share__link social-share__link--email"><a title="Share 'Postfix spam protection with greylisting using Postgrey on Debian 6/Ubuntu' via email" href=mailto:?subject=Postfix%20spam%20protection%20with%20greylisting%20using%20Postgrey%20on%20Debian%206/Ubuntu&body=I%20thought%20you%20might%20like%20'Postfix%20spam%20protection%20with%20greylisting%20using%20Postgrey%20on%20Debian%206/Ubuntu'%20--%20https%3A//kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/> <i aria-hidden=true class=material-icons> îƒ¡ </i> </a></ul></div><div class=eevee-article><div class="eevee-meta mdl-color-text--grey-500"><time datetime=2011-09-24T21:29:00+01:00 itemprop=datePublished> 24 Sep 2011 </time>Â â€” 2 min read</div><h1 itemprop=name><a title="Permalink to 'Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu'" href=https://kura.gg/2011/09/24/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu/ itemprop=url rel=bookmark> Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu </a></h1><section class=eevee-toc><h2 id=toc>Contents</h2><nav class=eevee-toc-ribbon><div class=toc><p class=topic-title>Contents<ul class=simple><li><a class="reference internal" href=#installation id=toc-entry-1>Installation</a><li><a class="reference internal" href=#configuring-postgrey id=toc-entry-2>ConfiguringÂ Postgrey</a><li><a class="reference internal" href=#configuring-postfix id=toc-entry-3>ConfiguringÂ Postfix</a><li><a class="reference internal" href=#testing id=toc-entry-4>Testing</a></ul></div></nav></section><section class=article-content itemprop=articleBody><p>A simple yet effective method for protecting your mail server from spam is to use greylisting. In simple terms, when an email is received the server will temporarily reject it with a 450 response code claiming that the server is busy, the sending server should then attempt to try to deliver at a later point in time, if enough time has passed the recipient server will then accept the incoming mail and whitelist the send address for a period ofÂ time.<p>This is effective because most spam servers are configured not to retry the send whereas real mail servers generally will retry. This sadly does not protect against spam coming from comprised mail servers or accounts like onÂ Hotmail.com.<div class=section id=installation><h2>Installation</h2><div class=highlight><pre><span></span>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>postgrey
</pre></div></div><div class=section id=configuring-postgrey><h2>ConfiguringÂ Postgrey</h2><p>By default Postgrey runs on <em>127.0.0.1:60000</em>, which is the local loopback interface so it is not exposed to the outsideÂ world.<p>If you open up <strong>/etc/default/postgrey</strong> and modify the <em>POSTGREY_OPTS</em> line you can configure how long to grey listÂ for.<div class=highlight><pre><span></span>--delay<span class=o>=</span><span class=m>60</span>
</pre></div><p>would greylist the sending server for 60 seconds (the default value is 300 second, 5 minutes), if a retry was attempted after 60 seconds the sender would automatically become whitelisted, by default this sender is whitelisted for 35 days but can be changed using the <em>â€”max-age</em>Â option<div class=highlight><pre><span></span>--max-age<span class=o>=</span><span class=m>10</span>
</pre></div><p>would whitelist for 10Â days.<p>They can be combined asÂ below.<div class=highlight><pre><span></span><span class=nv>POSTGREY_OPTS</span><span class=o>=</span><span class=s2>"--inet=127.0.0.1:60000 --delay=60 --max-age=10"</span>
</pre></div><p>Once youâ€™re satisfied save and closed and restartÂ Postgrey.<div class=highlight><pre><span></span>sudo<span class=w> </span>/etc/init.d/postgrey<span class=w> </span>restart
</pre></div></div><div class=section id=configuring-postfix><h2>ConfiguringÂ Postfix</h2><p>Open up <strong>/etc/postfix/main.cf</strong> and add the following within <em>smtpd_receipient_restrictions</em><pre class=literal-block>
check_policy_service inet:127.0.0.1:60000
</pre><p>This is best added after your <span class=caps>SASL</span> and sender domain checks but before <span class=caps>SPF</span> and blacklists, see below for anÂ example<pre class=literal-block>
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
    reject_unknown_sender_domain,
    check_policy_service inet:127.0.0.1:60000
</pre><p>Now reloadÂ Postfix<div class=highlight><pre><span></span>sudo<span class=w> </span>/etc/init.d/postfix<span class=w> </span>reload
</pre></div></div><div class=section id=testing><h2>Testing</h2><p>Now if you tail your mail.log you will see your Postgrey instance rejecting incoming email likeÂ below.<pre class=literal-block>
Sept 24 22:26:18 heimdall postfix/smtpd[4256]: NOQUEUE: reject: RCPT from example.com[xxx.xxx.xxx.xxx]: 450: Recipient address rejected: Greylisted for 300 seconds (see https://isg.ee.ethz.ch/tools/postgrey/help/spammed.com.html); from=to=proto=ESMTP helo=&LTexample.com>
</pre></div></section></div><div class=eevee-related><section><h2>Related articles</h2><ul><li><a title="Permalink to 'Postfix + DK (DomainKeys) + DKIM + SPF on DebianÂ 6/Ubuntu'" href=https://kura.gg/2011/09/17/postfix-dk-dkim-spf/ itemprop=url rel=bookmark> Postfix + <span class=caps>DK</span> (DomainKeys) + <span class=caps>DKIM</span> + <span class=caps>SPF</span> on DebianÂ 6/Ubuntu </a><li><a title="Permalink to 'Postfix + SpamAssassin + ClamAV + Procmail on DebianÂ 6/Ubuntu'" href=https://kura.gg/2011/09/16/postfix-spamassassin-clamav-procmail/ itemprop=url rel=bookmark> Postfix + SpamAssassin + ClamAV + Procmail on DebianÂ 6/Ubuntu </a><li><a title="Permalink to 'Postfix + Dovecot (IMAP/IMAPS) + SASL + Maildir on DebianÂ 6/Ubuntu'" href=https://kura.gg/2011/09/15/postfix-dovecot-imapimaps-sasl-maildir/ itemprop=url rel=bookmark> Postfix + Dovecot (<span class=caps>IMAP</span>/<span class=caps>IMAPS</span>) + <span class=caps>SASL</span> + Maildir on DebianÂ 6/Ubuntu </a><li><a title="Permalink to 'HOWTO: DomainKeys with Postfix onÂ Debian/Ubuntu'" href=https://kura.gg/2010/02/12/howto-domainkeys-with-postfix-on-debian-ubuntu/ itemprop=url rel=bookmark> <span class=caps>HOWTO</span>: DomainKeys with Postfix onÂ Debian/Ubuntu </a><li><a title="Permalink to 'Postfix spam protection withÂ blacklists'" href=https://kura.gg/2011/09/24/postfix-spam-protection-with-blacklists/ itemprop=url rel=bookmark> Postfix spam protection withÂ blacklists </a></ul></section></div><div class=eevee-ac><header class=eevee-ac__header><div class=eevee-ac-author__text><h2>Kura</h2><p>Anarchist. Pessimist. Bipolar. Hacker. Hyperpolyglot. Musician. Ex-(semi-)pro gamer. They/Them.<p><a title="Read more articles by Kura" href=https://kura.gg/authors/kura/ itemprop=url> Read more articles by Kura </a><nav><ul class=eevee-ac-author__social><li class=eevee-ac-author-social__link><a class="mdl-color-text--accent mdl-navigation__link" title="kura on GitHub" href=https://github.com/kura itemprop=url rel=bookmark> <i aria-hidden=true class=fa>ï‚›</i> </a><li class=eevee-ac-author-social__link><a class="mdl-color-text--accent mdl-navigation__link" title="kura on @kura@noc.social" href=https://noc.social/@kura itemprop=url rel=bookmark> <i aria-hidden=true class=fa>ðŸ¦£</i> </a></ul></nav></div><img alt=Kura class=eevee-ac-author__avatar src=/images/avatar.png></header></div></article><a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-color--accent mdl-color-text--white" title="View 'Postfix spam protection with greylisting using Postgrey on DebianÂ 6/Ubuntu' on GitHub" href=https://github.com/kura/kura.gg/blob/main/content/postfix-spam-protection-with-greylisting-using-postgrey-on-debian-6ubuntu.rst id=view-source> <i class=material-icons>î¡¯</i> View Source </a></div></div></main><div class="eevee-pagination__container eevee-container mdl-grid"><div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone" role=presentation></div><div class="mdl-color-text--grey-800 mdl-cell mdl-cell--8-col"><nav class="eevee-pagination mdl-cell mdl-cell--12-col" aria-label=Pagination itemscope itemtype=http://schema.org/SiteNavigationElement><a class=eevee-nav__button href=https://kura.gg/2011/09/29/load-balancing-httphttps-with-pound-on-debian-6ubuntu/ itemprop=url rel=bookmark title=Newer> <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation><i class=material-icons>î—„</i></button> Newer </a><div class=eevee-spacer></div><a class=eevee-nav__button href=https://kura.gg/2011/09/24/postfix-spam-protection-with-blacklists/ itemprop=url rel=bookmark title=Older> Older <button class="mdl-button mdl-button--icon mdl-color--white mdl-color-text--grey-900" role=presentation><i class=material-icons>î—ˆ</i></button> </a></nav></div></div><footer class=mdl-mega-footer itemscope itemtype=http://schema.org/SiteNavigationElement><div class=mdl-mega-footer--top-section><div class=mdl-mega-footer--drop-down-section><ul class=mdl-mega-footer--link-list><li><a title="Back to the top of the page" href=#top itemprop=url> Back to the top of the page </a></ul></div></div><div aria-label="Footer navigation" class=mdl-mega-footer--middle-section itemscope itemtype=http://schema.org/SiteNavigationElement><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Menu</h1><ul class=mdl-mega-footer--link-list><li><a href=/contact/ itemprop=url rel=bookmark title=Contact> <i aria-hidden=true class=material-icons>î‚·</i> Contact </a><li><a href=https://kura.gg/archives/ itemprop=url rel=bookmark title=Archives> <i class=material-icons>î€¯</i> Archives </a><li><a href=https://kura.gg/feeds/rss.xml itemprop=url title=RSS> <i class=material-icons>îƒ¥</i> RSS </a><li><a href=https://kura.gg/feeds/atom.xml itemprop=url title=Atom> <i class=material-icons>îƒ¥</i> Atom </a></ul></div><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Social</h1><ul class=mdl-mega-footer--link-list><li><a href=https://github.com/kura itemprop=url rel=bookmark title=GitHub> <i aria-hidden=true class=fa>ï‚›</i> Github </a><li><a href=https://noc.social/@kura itemprop=url rel=me title=@kura@noc.social> <i aria-hidden=true class=fa>ðŸ¦£</i> @kura@noc.social </a></ul></div><div class=mdl-mega-footer--drop-down-section><h1 class=mdl-mega-footer--heading>Links</h1><ul class=mdl-mega-footer--link-list><li><a href=/blackhole itemprop=url rel=bookmark title=Blackhole> <i aria-hidden=true class=material-icons>î¡¯</i> Blackhole </a><li><a href=/eevee itemprop=url rel=bookmark title=Eevee> <i aria-hidden=true class=material-icons>î¡±</i> Eevee </a><li><a href=/hauntr itemprop=url rel=bookmark title=Hauntr> <i aria-hidden=true class=material-icons>î¡±</i> Hauntr </a><li><a href=/ghastly itemprop=url rel=bookmark title=Ghastly> <i aria-hidden=true class=material-icons>î¡±</i> Ghastly </a><li><a title="Pelican Plugins" href=/pelican-plugins itemprop=url rel=bookmark> <i aria-hidden=true class=material-icons>î¡¯</i> Pelican Plugins </a></ul></div></div><div class=mdl-mega-footer--bottom-section><div class=mdl-logo><a href=https://kura.gg itemprop=url rel=bookmark title=kura.gg> kura.gg </a></div><ul class="eevee-footer mdl-mega-footer--link-list"><li>Powered by love & rainbow sparkles.<li>Source code and content released under the <a title="MIT license" href=/license/>MIT license</a>.</ul></div></footer></div>